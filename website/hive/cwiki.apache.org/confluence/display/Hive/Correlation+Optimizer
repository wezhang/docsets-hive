<!DOCTYPE html>
<html>
<head>
                    <title>Correlation Optimizer - Apache Hive - Apache Software Foundation</title>
    
        

                        
    
                        
    

                
    
    <meta http-equiv="X-UA-Compatible" content="IE=EDGE,chrome=IE7">
<meta charset="UTF-8">
<meta id="confluence-context-path" name="confluence-context-path" content="/confluence">
<meta id="confluence-base-url" name="confluence-base-url" content="https://cwiki.apache.org/confluence">

<meta id="atlassian-token" name="atlassian-token" content="735c8f668271f8e1dea73527ae5689ca93f07505">


<meta id="confluence-space-key" name="confluence-space-key" content="Hive">
<script type="text/javascript">
        var contextPath = '/confluence';
</script>

    

    <meta name="confluence-request-time" content="1451833704915">
        
    
        
            <meta name="ajs-is-space-admin" content=""> <meta name="ajs-has-space-config" content="">
            <style>.ia-fixed-sidebar, .ia-splitter-left {width: 285px;}.theme-default .ia-splitter #main {margin-left: 285px;}.ia-fixed-sidebar {visibility: hidden;}</style>
            <meta name="ajs-use-keyboard-shortcuts" content="true">
            <meta name="ajs-discovered-plugin-features" content="$discoveredList">
            <meta name="ajs-keyboardshortcut-hash" content="38450baaed51271899c8e867d2a48ca9">
            <meta name="ajs-is-confluence-admin" content="false">
            <meta name="ajs-connection-timeout" content="10000">
            <meta name="gliffy-license-type" content="LicenseType&lt;COMMUNITY&gt;">
<meta name="gliffy-license-quantity" content="${pluginLicenseManager.userCount}">

            <script type="text/x-template" title="gliffy-webpanel-footer">
        <div class="gliffy-webpanel-footer"><span>This Confluence installation runs a Free Gliffy License - Evaluate the <a href="http://www.gliffy.com/products/confluence-plugin/">Gliffy Confluence Plugin</a> for your Wiki!</span></div>
</script>


            
    
    
            <meta name="ajs-page-id" content="34019487">
            <meta name="ajs-latest-page-id" content="34019487">
            <meta name="ajs-content-type" content="page">
            <meta name="ajs-page-title" content="Correlation Optimizer">
            <meta name="ajs-parent-page-title" content="DesignDocs">
            <meta name="ajs-parent-page-id" content="27362075">
            <meta name="ajs-space-key" content="Hive">
            <meta name="ajs-space-name" content="Apache Hive">
            <meta name="ajs-jira-metadata-count" content="0">
            <meta name="ajs-from-page-title" content="">
            <meta name="ajs-can-remove-page" content="false">
            <meta name="ajs-browse-page-tree-mode" content="view">
            <meta name="ajs-shared-drafts" content="false">
            <meta name="ajs-context-path" content="/confluence">
            <meta name="ajs-base-url" content="https://cwiki.apache.org/confluence">
            <meta name="ajs-version-number" content="5.8.4">
            <meta name="ajs-build-number" content="5982">
            <meta name="ajs-remote-user" content="">
            <meta name="ajs-remote-user-key" content="">
            <meta name="ajs-current-user-fullname" content="">
            <meta name="ajs-current-user-avatar-url" content="">
            <meta name="ajs-static-resource-url-prefix" content="/confluence/s/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/_">
            <meta name="ajs-global-settings-attachment-max-size" content="20971520">
            <meta name="ajs-user-locale" content="en_GB">
            <meta name="ajs-enabled-dark-features" content="confluence-inline-comments-resolved,notification.plugin.api.enabled.com.atlassian.confluence.plugins.sharepage.api.ShareContentEvent,notification.plugin.api.enabled.com.atlassian.confluence.plugins.mentions.api.ConfluenceMentionEvent,notification.plugin.api.enabled.com.atlassian.confluence.event.events.security.ForgotPasswordEvent,pdf-preview,notification.plugin.api.enabled.com.atlassian.confluence.plugins.tasklist.event.SendTaskEmailEvent,notification.plugin.api.enabled.com.atlassian.confluence.event.events.content.page.async.PageMovedEvent,previews.sharing,previews.versions,notification.plugin.api.enabled.com.atlassian.confluence.plugins.files.notifications.event.FileContentUpdateEvent,file-annotations,notification.plugin.api.enabled.com.atlassian.confluence.event.events.content.attachment.AttachmentBatchUploadCompletedEvent,notification.plugin.api.enabled.com.atlassian.confluence.event.events.content.comment.CommentCreateEvent,notification.plugin.api.enabled.com.atlassian.confluence.efi.emails.events.OnboardingLessUsersEvent,notification.plugin.api.enabled.com.atlassian.confluence.plugins.files.notifications.event.FileContentRemoveEvent,atlassian.aui.raphael.disabled,previews.conversion-service,notification.plugin.api.enabled.com.atlassian.confluence.event.events.content.comment.CommentUpdateEvent,notification.plugin.api.enabled.com.atlassian.confluence.event.events.follow.FollowEvent,notification.plugin.api.enabled.com.atlassian.confluence.event.events.content.page.async.PageEditedEvent,notification.plugin.api.enabled.com.atlassian.confluence.event.events.content.blogpost.BlogPostCreateEvent,previews.trigger-all-file-types,notification.plugin.api.enabled.com.atlassian.confluence.plugins.inlinecomments.events.InlineCommentResolveEvent,notification.plugin.api.enabled.com.atlassian.confluence.event.events.like.LikeCreatedEvent,notification.plugin.api.enabled.com.atlassian.confluence.plugins.inlinecomments.events.InlineCommentCreateEvent,previews.sharing.pushstate,confluence-inline-comments-rich-editor,notification.plugin.api.enabled.com.atlassian.confluence.event.events.content.blogpost.BlogPostUpdateEvent,file-annotations.likes,notification.plugin.api.enabled.com.atlassian.confluence.event.events.content.page.async.PageCreatedEvent,notification.plugin.api.enabled.com.atlassian.confluence.plugins.files.notifications.event.FileContentMentionUpdateEvent,notification.plugin.api.enabled.com.atlassian.confluence.efi.emails.events.OnboardingNoSpaceCreatedEvent,notification.plugin.api.enabled.com.atlassian.confluence.plugins.hipchat.api.events.HipChatUserMapped,notification.plugin.api.enabled.com.atlassian.confluence.plugins.sharepage.api.ShareAttachmentEvent,confluence-inline-comments,confluence-inline-comments-dangling-comment,notification.plugin.api.enabled.com.atlassian.confluence.event.events.content.blogpost.BlogPostMovedEvent">
            <meta name="ajs-atl-token" content="735c8f668271f8e1dea73527ae5689ca93f07505">
            <meta name="ajs-confluence-flavour" content="VANILLA">
            <meta name="ajs-user-date-pattern" content="dd MMM yyyy">
            <meta name="ajs-date.format" content="MMM dd, yyyy">
    
    <link rel="shortcut icon" href="../../s/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/_/favicon.ico">
    <link rel="icon" type="image/x-icon" href="../../s/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/_/favicon.ico">

<link rel="search" type="application/opensearchdescription+xml" href="https://cwiki.apache.org/confluence/opensearch/osd.action" title="Apache Software Foundation"/>
    
                    
            <meta name="ajs-create-issue-metadata-show-discovery" content="false">
            

<script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path.context-path"]="\"/confluence\"";
WRM._unparsedData["com.atlassian.plugins.atlassian-nps-plugin:atlassian-nps-plugin-resources.is-server-instance-data-provider"]="true";
WRM._unparsedData["com.atlassian.plugins.browser.metrics.browser-metrics-plugin:browser-metrics.feature-data-provider-legacy"]="true";
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-rest:web-resource-manager.resource-base-url-pattern"]="\"(?:/confluence(?:/s/.*?/_)?/download)\"";
WRM._unparsedData["com.atlassian.confluence.plugins.confluence-license-banner:confluence-license-banner-resources.license-details"]="{\"daysBeforeLicenseExpiry\":0,\"daysBeforeMaintenanceExpiry\":0,\"showLicenseExpiryBanner\":false,\"showMaintenanceExpiryBanner\":false,\"renewUrl\":null,\"salesEmail\":null}";
WRM._unparsedData["com.atlassian.confluence.plugins.confluence-hipchat-integration-plugin:discovery-javascript-data.link-active"]="{\"linkActive\":true,\"conditionsMet\":true,\"admin\":false}";
WRM._unparsedData["com.atlassian.plugins.atlassian-nps-plugin:nps-acknowledgement-resources.analytics-enabled-data-provider"]="\"true\"";
WRM._unparsedData["com.atlassian.plugins.atlassian-nps-plugin:nps-acknowledgement-resources.sen-data-provider"]="\"SEN-2015076\"";
WRM._unparsedData["com.atlassian.confluence.plugins.confluence-feature-discovery-plugin:confluence-feature-discovery-plugin-resources.test-mode"]="false";
WRM._unparsedData["com.atlassian.plugins.browser.metrics.browser-metrics-plugin:api.feature-data-provider"]="true";
</script>
<link type="text/css" rel="stylesheet" href="../../s/2e51e60e83eadbb79c5004bd9c4ac765-CDN/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/68/_/download/superbatch/css/batch.css@build-number=5982" media="all">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/confluence/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/68/_/download/superbatch/css/batch.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<!--[if lte IE 9]>
<link type="text/css" rel="stylesheet" href="/confluence/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/68/_/download/superbatch/css/batch.css?conditionalComment=lte+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/9b6bdeb7fddc0a2f5337e313f4e85615-T/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/ec13b76cd8d002fa2cf4ca229002aee7/_/download/contextbatch/css/page,viewcontent,atl.general,main,pagebanner,atl.comments/batch.css@highlightactions=true&amp;locale=en-GB&amp;flavour=VANILLA" media="all">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/confluence/s/6c0981174e94142364564819dc0d1413-CDN/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/ec13b76cd8d002fa2cf4ca229002aee7/_/download/contextbatch/css/page,viewcontent,atl.general,main,pagebanner,atl.comments/batch.css?conditionalComment=lt+IE+9&amp;locale=en-GB" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/2.1.5/_/download/batch/com.atlassian.confluence.ext.newcode-macro-plugin%253Asyntaxhighlighter/com.atlassian.confluence.ext.newcode-macro-plugin%253Asyntaxhighlighter.css" media="all">
<link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/2.1.5/_/download/batch/com.atlassian.confluence.ext.newcode-macro-plugin%253Ash-theme-default/com.atlassian.confluence.ext.newcode-macro-plugin%253Ash-theme-default.css" media="all">
<link type="text/css" rel="stylesheet" href="../../s/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/13/_/styles/colors.css@spaceKey=Hive" media="all">
<link type="text/css" rel="stylesheet" href="../../s/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/1.0/_/download/resources/com.atlassian.confluence.themes.default%253Astyles/default-theme.css" media="all">
<script type="text/javascript" src="../../s/b5b7f3c4a47ebde54b884c3070e3bb8c-CDN/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/68/_/download/superbatch/js/batch.js@atlassian.aui.raphael.disabled=true&amp;locale=en-GB&amp;build-number=5982" ></script>
<script type="text/javascript" src="../../s/47fb273cd38c3662368839aefb134f70-T/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/ec13b76cd8d002fa2cf4ca229002aee7/_/download/contextbatch/js/page,viewcontent,atl.general,main,pagebanner,atl.comments/batch.js@highlightactions=true&amp;analytics-uploadable=true&amp;flavour=VANILLA&amp;nps-acknowledged=true&amp;analytics-enabled=true&amp;locale=en-GB&amp;anonymous-access-enabled=true&amp;is-server-instance=true&amp;hostenabled=true" ></script>
<script type="text/javascript" src="../../s/6c0981174e94142364564819dc0d1413-CDN/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/2.1.5/_/download/batch/com.atlassian.confluence.ext.newcode-macro-plugin%253Asyntaxhighlighter/com.atlassian.confluence.ext.newcode-macro-plugin%253Asyntaxhighlighter.js@locale=en-GB" ></script>
<script type="text/javascript" src="../../s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/2.1.5/_/download/batch/com.atlassian.confluence.ext.newcode-macro-plugin%253Asyntaxhighlighter-brushes/com.atlassian.confluence.ext.newcode-macro-plugin%253Asyntaxhighlighter-brushes.js" ></script>


        
    

        
        <meta name="ajs-site-title" content="Apache Software Foundation" />

    
    

    
                <link rel="canonical" href="Correlation+Optimizer">
        <link rel="shortlink" href="https://cwiki.apache.org/confluence/x/nxgHAg">
    <meta name="wikilink" content="[Hive:Correlation Optimizer]">
    <meta name="page-version" content="13">

</head>

<body             onload="placeFocus()"
     id="com-atlassian-confluence" class="theme-default  aui-layout aui-theme-default">

        
            <div id='stp-licenseStatus-banner'></div>
    <ul id="assistive-skip-links" class="assistive">
    <li><a href="Correlation+Optimizer#title-heading">Skip to content</a></li>
    <li><a href="Correlation+Optimizer#breadcrumbs">Skip to breadcrumbs</a></li>
    <li><a href="Correlation+Optimizer#header-menu-bar">Skip to header menu</a></li>
    <li><a href="Correlation+Optimizer#navigation">Skip to action menu</a></li>
    <li><a href="Correlation+Optimizer#quick-search-query">Skip to quick search</a></li>
</ul>
<div id="page">
<div id="full-height-container">
    <div id="header-precursor">
        <div class="cell">
            <style type="text/css">
#preview #previewArea iframe {

   overflow: visible;
}
</style>

                            </div>
    </div>
    



<header id="header" role="banner">
    <nav class="aui-header aui-dropdown2-trigger-group" role="navigation"><div class="aui-header-inner"><div class="aui-header-before"><a class=" aui-dropdown2-trigger app-switcher-trigger" aria-owns="app-switcher" aria-controls="app-switcher" aria-haspopup="true" data-aui-trigger href="Correlation+Optimizer#app-switcher"><span class="aui-icon aui-icon-small aui-iconfont-appswitcher">Linked Applications</span></a><div id="app-switcher" class="aui-dropdown2 aui-style-default"><div class="app-switcher-loading">Loading&hellip;</div></div><script>
            (function (NL) {
                var initialise = function () {
                    // For some milestones of AUI, the atlassian soy namespace was renamed to aui. Handle that here by ensuring that window.atlassian is defined.
                    window.atlassian = window.atlassian || window.aui;
                    new NL.AppSwitcher({
                        dropdownContents: '#app-switcher'
                    });
                };
                if (NL.AppSwitcher) {
                    initialise();
                } else {
                    NL.onInit = initialise;
                }
            }(window.NL = (window.NL || {})));
            window.NL.isUserAdmin = false</script></div><div class="aui-header-primary"><h1 id="logo" class="aui-header-logo aui-header-logo-custom"><a href="https://cwiki.apache.org/confluence/"><img src="../../s/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/_/images/logo/confluence-logo.png" alt="Apache Software Foundation" /></a></h1><ul class="aui-nav">
                            <li>
            
        
        
<a  id="space-directory-link" href="https://cwiki.apache.org/confluence/spacedirectory/view.action"  class=" aui-nav-imagelink"   title="Spaces">
            <span>Spaces</span>
    </a>
        </li>
                        </ul>
</div><div class="aui-header-secondary"><ul class="aui-nav">
                        <li>
        <form id="quick-search" class="aui-quicksearch dont-default-focus header-quicksearch" action="https://cwiki.apache.org/confluence/dosearchsite.action" method="get"><fieldset><label for="quick-search-query" class="assistive">Quick Search</label><input id="quick-search-query" class="text app-search search quick-search-query" type="text" accessKey="q" autocomplete="off" name="queryString" title="Quick Search" placeholder="Search" /><input id="quick-search-submit" class="quick-search-submit" type="submit" value="Search"/><div class="aui-dd-parent quick-nav-drop-down"></div></fieldset></form>
    </li>
        <li>
            
        <a id="help-menu-link" class="aui-nav-link aui-dropdown2-trigger" href="Correlation+Optimizer#" aria-haspopup="true" aria-owns="help-menu-link-content" title="Help">
        <span class="aui-icon aui-icon-small aui-iconfont-help">Help</span>
    </a>
    <nav id="help-menu-link-content" class="aui-dropdown2 aui-style-default" aria-hidden="true">
                    <div class="aui-dropdown2-section">
                                <ul  id="help-menu-link-leading" class="aui-list-truncate section-leading first">
                                            <li>
        
            
<a  id="confluence-help-link" href="https://docs.atlassian.com/confluence/docs-58/Getting+Help+And+Support" class="    "      title="Visit the Confluence documentation home"  target="_blank"
>
        Online Help
</a>
</li>
                                            <li>
    
            
<a  id="keyboard-shortcuts-link" href="https://cwiki.apache.org/confluence" class="    "      title="View available keyboard shortcuts" >
        Keyboard Shortcuts
</a>
</li>
                                            <li>
    
            
<a  id="feed-builder-link" href="https://cwiki.apache.org/confluence/dashboard/configurerssfeed.action" class="    "      title="Create your custom RSS feed." >
        Feed Builder
</a>
</li>
                                            <li>
    
            
<a  id="whats-new-menu-link" href="https://docs.atlassian.com/confluence/docs-58/whatsnew/iframe" class="    "      title="" >
        What’s new
</a>
</li>
                                            <li>
    
            
<a  id="whats-new-menu-link" href="https://docs.atlassian.com/confluence/docs-58/whatsnew/iframe" class="    "      title="" >
        What’s new
</a>
</li>
                                            <li>
    
            
<a  id="gadget-directory-link" href="https://cwiki.apache.org/confluence" class="   user-item administration-link "      title="Browse gadgets provided by Confluence" >
        Available Gadgets
</a>
</li>
                                            <li>
    
            
<a  id="confluence-about-link" href="https://cwiki.apache.org/confluence/aboutconfluencepage.action" class="    "      title="Get more information about Confluence" >
        About Confluence
</a>
</li>
                                    </ul>
            </div>
            </nav>
    
    </li>
        <li>
                
    
    </li>
        <li>
            
    </li>
        <li>
                                            <li>
        
            
<a  id="login-link" href="https://cwiki.apache.org/confluence/login.action?os_destination=%2Fdisplay%2FHive%2FCorrelation%2BOptimizer" class="   user-item login-link "      title="" >
        Log in
</a>
</li>
                        <li>
    
            
<a  id="signup-link" href="https://cwiki.apache.org/confluence/signup.action" class="   user-item signup-link "      title="" >
        Sign up
</a>
</li>
                        
    </li>
    </ul>
</div></div><!-- .aui-header-inner--></nav><!-- .aui-header -->
    <br class="clear">
</header>

    
    	<div class="ia-splitter">
    		<div class="ia-splitter-left">
    			<div class="ia-fixed-sidebar">
    				
	    	<div class="acs-side-bar ia-scrollable-section"><div class="acs-side-bar-space-info tipsy-enabled" data-configure-tooltip="Edit space details"><div class="avatar"><div class="space-logo " data-key="Hive" data-name="Apache Hive" data-entity-type="confluence.space"><div class="avatar-img-container"><div class="avatar-img-wrapper"><a href="https://cwiki.apache.org/confluence/display/Hive" title="Apache Hive"><img class="avatar-img" src="../../download/attachments/27362113/Hive@version=2&amp;modificationDate=1317659390000&amp;api=v2" alt="Apache Hive"></a></div></div></div></div><div class="name"><a href="https://cwiki.apache.org/confluence/display/Hive" title="Apache Hive">Apache Hive</a></div><div class="flyout-handle icon"></div></div><div class="acs-side-bar-content"><div class="acs-nav-wrapper"><div class="acs-nav" data-has-create-permission="false" data-quick-links-state="null" data-nav-type="pages"><div class="acs-nav-sections"><div class="main-links-section "><ul class="acs-nav-list"><li class="acs-nav-item wiki current-item"data-collector-key="spacebar-pages"><a class="acs-nav-item-link tipsy-enabled" href="https://cwiki.apache.org/confluence/collector/pages.action?key=Hive" data-collapsed-tooltip="Pages"><span class="icon"></span><span class="acs-nav-item-label">Pages</span></a></li><li class="acs-nav-item blog"data-collector-key="spacebar-blogs"><a class="acs-nav-item-link tipsy-enabled" href="https://cwiki.apache.org/confluence/pages/viewrecentblogposts.action?key=Hive" data-collapsed-tooltip="Blog"><span class="icon"></span><span class="acs-nav-item-label">Blog</span></a></li></ul></div><div class="quick-links-wrapper"></div></div></div></div><div class="ia-secondary-container tipsy-enabled" data-tree-type="pages"><div class="ia-secondary-header"><h5 class="ia-secondary-header-title pages"><span class="label">Child pages</span></h5></div><div class="ia-secondary-parent-content"><ul class="parent ia-secondary-header-title wiki"><li class="parent-item"><a class="parent-item-link" href="DesignDocs" title="DesignDocs"><span class="icon"></span><span class="label">DesignDocs</span></a></li></ul></div><div class="ia-secondary-current-content"><ul class="ia-secondary-currentPage-title wiki current-item"><li><span class="icon"></span><span class="label">Correlation Optimizer</span></li></ul></div><div class="ia-secondary-content"><div class="contextual-nav-child-pages"></div></div></div></div><div class="hidden"><a href="https://cwiki.apache.org/confluence/collector/pages.action?key=Hive" id="space-pages-link"></a><script type="text/x-template" title="logo-config-content"><h2>Space Details</h2><div class="personal-space-logo-hint">Your profile picture is used as the logo for your personal space. <a href="https://cwiki.apache.org/confluence/users/profile/editmyprofilepicture.action" target="_blank">Change your profile picture</a>.</div></script></div></div><div class="space-tools-section"><div id="space-tools-menu-additional-items" class="hidden"><div data-label="Browse pages" data-class="" data-href="/confluence/pages/reorderpages.action?key=Hive">Browse pages</div></div><div id="space-tools-dd-dummy"></div><a id="space-tools-menu-trigger" class="aui-button aui-button-subtle aui-dropdown2-trigger tipsy-enabled" aria-owns="space-tools-dd-dummy"><span class="aui-icon aui-icon-small aui-iconfont-configure">Configure</span><span class="label">Space tools</span></a><a class="expand-collapse-trigger"></a></div>
    
    			</div>
    		</div>
        <!-- \#header -->

        
        <div id="main" class=" aui-page-panel">
                <div id="main-header">
            
    <div id="navigation" class="content-navigation view">
                    <ul class="ajs-menu-bar">
                                                        
                    
        <li class="normal ajs-menu-item">
        <a id="action-menu-link" class="action aui-dropdown2-trigger-arrowless aui-button aui-button-subtle ajs-menu-title aui-dropdown2-trigger" href="Correlation+Optimizer#" aria-haspopup="true" aria-owns="action-menu" data-container="#navigation">
            <span>
                                    <span class="aui-icon aui-icon-small aui-iconfont-more"></span>
                                
            </span>
        </a>         <div id="action-menu" class="aui-dropdown2 aui-style-default">
                            <ul  id="action-menu-primary"                     class="section-primary first aui-dropdown2-section">
                                            <li>

    
        
                                            
    
    
    <a  id="view-attachments-link" href="https://cwiki.apache.org/confluence/pages/viewpageattachments.action?pageId=34019487" rel="nofollow" class="action-view-attachments"  accessKey="t"  title="View Attachments">
                <span>
                        A<u>t</u>tachments (6)
        </span>    </a>
</li>
                                        <li>

    
        
                                            
    
    
    <a  id="action-view-history-link" href="https://cwiki.apache.org/confluence/pages/viewpreviousversions.action?pageId=34019487" rel="nofollow" class="action-view-history"   title="">
                <span>
                        Page History
        </span>    </a>
</li>
                                        <li>

    
        
                                            
    
    
    <a  id="action-page-permissions-link" href="https://cwiki.apache.org/confluence/pages/viewinfo.action?pageId=34019487" rel="nofollow" class="action-page-permissions"   title="Edit restrictions">
                <span>
                        Restrictions
        </span>    </a>
</li>
                                </ul>
                            <ul  id="action-menu-secondary"                     class="section-secondary aui-dropdown2-section">
                                            <li>

    
        
                                            
    
    
    <a  id="view-page-info-link" href="https://cwiki.apache.org/confluence/pages/viewinfo.action?pageId=34019487" rel="nofollow" class="action-view-info"   title="">
                <span>
                        Page Information
        </span>    </a>
</li>
                                        <li>

    
        
                                            
    
    
    <a  id="view-resolved-comments" href="https://cwiki.apache.org/confluence" rel="nofollow" class=""   title="">
                <span>
                        Resolved comments
        </span>    </a>
</li>
                                        <li>

    
        
                                            
    
    
    <a  id="link-to-page-link" href="https://cwiki.apache.org/confluence/pages/viewinfo.action?pageId=34019487" rel="nofollow" class=""   title="Link to this Page">
                <span>
                        Link to this Page…
        </span>    </a>
</li>
                                        <li>

    
        
                                            
    
    
    <a  id="view-in-hierarchy-link" href="https://cwiki.apache.org/confluence/pages/reorderpages.action?key=Hive&amp;openId=34019487#selectedPageInHierarchy" rel="nofollow" class=""   title="">
                <span>
                        View in Hierarchy
        </span>    </a>
</li>
                                        <li>

    
        
                                            
    
    
    <a  id="action-view-source-link" href="https://cwiki.apache.org/confluence/plugins/viewsource/viewpagesrc.action?pageId=34019487" rel="nofollow" class="action-view-source popup-link"   title="">
                <span>
                        View Source
        </span>    </a>
</li>
                                        <li>

    
        
                                            
    
    
    <a  id="delete-all-comments-link-link" href="https://cwiki.apache.org/confluence/plugins/aptis/deleteAllComments/ask-user.action?pageId=34019487" rel="nofollow" class=""   title="">
                <span>
                        Delete comments
        </span>    </a>
</li>
                                        <li>

    
        
                                            
    
    
    <a  id="action-export-pdf-link" href="https://cwiki.apache.org/confluence/spaces/flyingpdf/pdfpageexport.action?pageId=34019487" rel="nofollow" class=""   title="">
                <span>
                        Export to PDF
        </span>    </a>
</li>
                                        <li>

    
        
                                            
    
    
    <a  id="com-k15t-confluence-scroll-epub-launcher" href="https://cwiki.apache.org/confluence/pages/viewpage.action?pageId=34019487" rel="nofollow" class=""   title="">
                <span>
                        Export to EPUB
        </span>    </a>
</li>
                                        <li>

    
        
                                            
    
    
    <a  id="action-export-word-link" href="https://cwiki.apache.org/confluence/exportword?pageId=34019487" rel="nofollow" class="action-export-word"   title="">
                <span>
                        Export to Word
        </span>    </a>
</li>
                                </ul>
                            <ul  id="action-menu-modify"                     class="section-modify aui-dropdown2-section">
                                            <li>

    
        
                                            
    
    
    <a  id="treecopy-action" href="https://cwiki.apache.org/confluence/plugins/treecopy/setnames.action?pageId=34019487" rel="nofollow" class=""   title="">
                <span>
                        Copy Page Tree
        </span>    </a>
</li>
                                </ul>
                    </div>
    </li>
            </ul>
    </div>

            
            <div id="title-heading" class="pagetitle with-breadcrumbs">
                
                                    <div id="breadcrumb-section">
                        
    
    
    <ol id="breadcrumbs">
                                        
                        
        <li class="first" >
                        
                            <span class=""><a href="https://cwiki.apache.org/confluence/collector/pages.action?key=Hive">Pages</a></span>
                                                                    
                        
        <li>
                        
                            <span class=""><a href="DesignDocs">DesignDocs</a></span>
                                                    </ol>


                    </div>
                
                
        <a href="Correlation+Optimizer#page-banner-end" class="assistive">Skip to end of banner</a>
<div id="page-banner-start" class="assistive"></div>

                    
            <div id="page-metadata-banner"><ul class="banner"><li id="system-content-items" class="noprint"><a href="Correlation+Optimizer" title="Restrictions apply" id="content-metadata-page-restrictions" class="hidden"><img class="page-banner-item-icon" src="../../s/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/_/download/resources/com.atlassian.confluence.plugins.confluence-page-banner%253Apage-banner-resources/images/red_padlock.png" style="height: 16px; width: 16px;"/></a><a href="https://cwiki.apache.org/confluence/pages/viewpageattachments.action?pageId=34019487&amp;metadataLink=true" title="6 attachments" id="content-metadata-attachments" ><img class="page-banner-item-icon" src="../../s/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/_/download/resources/com.atlassian.confluence.plugins.confluence-page-banner%253Apage-banner-resources/images/grey_attach.png" style="height: 16px; width: 16px;"/></a></li><li class="page-metadata-item noprint has-button"  id="content-metadata-jira-wrapper"><a href="Correlation+Optimizer" title="" id="content-metadata-jira" class="aui-button aui-button-subtle content-metadata-jira tipsy-disabled hidden"><img class="page-banner-item-icon" src="../../s/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/_/download/resources/com.atlassian.confluence.plugins.confluence-jira-metadata%253Aconfluence-jira-metadata-resources/img/icon-jira-link.png" style="height: 16px; width: 16px;"/><span>JIRA links</span></a></li></ul></div>
            

<a href="Correlation+Optimizer#page-banner-start" class="assistive">Go to start of banner</a>
<div id="page-banner-end" class="assistive"></div>
    

                <h1 id="title-text" class="with-breadcrumbs">
                                                <a href="Correlation+Optimizer">Correlation Optimizer</a>
                                    </h1>
            </div>
        </div><!-- \#main-header -->
        
        

        <div id="sidebar-container">
                                                </div><!-- \#sidebar-container -->

        
    

        




        

    
    
        
    
    
                    
    

                        
    
    

    




<div id="content" class="page view">
    


<div id="action-messages">
                        </div>



        <script type="text/x-template" title="searchResultsGrid">
    <table class="aui">
        <thead>
            <tr class="header">
                <th class="search-result-title">Page Title</th>
                <th class="search-result-space">Space</th>
                <th class="search-result-date">Updated</th>
            </tr>
        </thead>
    </table>
</script>
<script type="text/x-template" title="searchResultsGridCount">
    <p class="search-result-count">{0}</p>
</script>
<script type="text/x-template" title="searchResultsGridRow">
    <tr class="search-result">
        <td class="search-result-title"><a href="https://cwiki.apache.org/confluence/display/Hive/{1}" class="content-type-{2}"><span>{0}</span></a></td>
        <td class="search-result-space"><a class="space" href="https://cwiki.apache.org/confluence/display/{4}/" title="{3}">{3}</a></td>
        <td class="search-result-date"><span class="date" title="{6}">{5}</span></td>
    </tr>
</script>
        
    
            

        
                            
    

                    

        
        <a href="Correlation+Optimizer#page-metadata-end" class="assistive">Skip to end of metadata</a>
<div id="page-metadata-start" class="assistive"></div>

    <div class="page-metadata">
        <ul>
            <li class="page-metadata-modification-info">
                
        
    
        
    
        
        
            Created by <span class='author'>     <a href="https://cwiki.apache.org/confluence/display/~yhuai"
                       class="url fn"
                            >Yin Huai</a></span>, last modified on <a class='last-modified' title='Apr 01, 2014 18:57' href='https://cwiki.apache.org/confluence/pages/diffpagesbyversion.action?pageId=34019487&amp;selectedPageVersions=12&amp;selectedPageVersions=13'>Apr 01, 2014</a>
                </li>
        </ul>
    </div>


<a href="Correlation+Optimizer#page-metadata-start" class="assistive">Go to start of metadata</a>
<div id="page-metadata-end" class="assistive"></div>

        
                                            
        <div id="main-content" class="wiki-content">
                           
        <p>This page documents Correlation Optimizer. It was originally introduced by <a href="https://issues.apache.org/jira/browse/HIVE-2206" class="external-link" rel="nofollow">HIVE-2206</a> and based on the idea of YSmart [1]. To turn on this optimizer, you can use ...</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script type="syntaxhighlighter" class="brush: sql; gutter: false; theme: Default"><![CDATA[set hive.optimize.correlation=true;]]></script>
</div></div><h2 id="CorrelationOptimizer-1.Overview">1. Overview</h2><p>In Hadoop environments, an SQL query submitted to Hive will be evaluated in distributed systems. Thus, after generating a query operator tree representing the submitted SQL query, Hive needs to determine what operations can be executed in a task which will be evalauted in a single node. Also, since a MapReduce job can shuffle data data once, Hive also needs to cut the tree to multiple MapReduce jobs. It is important to cut an operator tree to multiple MapReduce in a good way, so the generated plan can evaluate the query efficiently.</p><p>When generating an operator tree for a given SQL query, Hive identifies when to shuffle the data through operations which may need to shuffle data. For example, a <code>JOIN</code> operation may need to shuffle the input data if input tables have not been distributed by join columns. However, in a complex query, it is possible that the input data of an operation which may need to shuffle the input data has already been partitioned in the desired way. For example, it is possible we can have a query like <code>SELECT t1.key, sum(value) FROM t1 JOIN t2 ON (t1.key = t2.key) GROUP BY t1.key</code>. In this example, both <code>JOIN</code> operation and <code>GROUP BY</code> operation may need to shuffle the input data. However, because the output of <code>JOIN</code> operation is the input of <code>GROUP BY</code> operation and it has been already partitioned by <code>t1.key</code>, we do not need to shuffle the data for <code>GROUP BY</code> operation. However, Hive is not aware this correlation between <code>JOIN</code> operation and <code>GROUP BY</code> operation and thus it will generate two separate MapReduce jobs to evaluate this query. Basically, we unnecessarily shuffle the data for <code>GROUP BY</code> operation. In a more complex query, correlation-unaware query planning can generate a very inefficient execution plan and result in poor performance.</p><p>Before we integrating Correlation Optimizer into Hive, Hive has ReduceSink Deduplication Optimizer which can figure out if we need to shuffle data for chained operators. However, to support more complex operator trees, we need a more general-purpose optimizer and a mechanism to correctly execute optimized plan. Thus, we have designed and implemented Correlation Optimizer and two operators for evaluating optimized plans. It is worth noting that it is better to use ReduceSink Deduplication Optimizer to handle simple cases first and then use Correlation Optimizer to handle more complex cases.</p><h2 id="CorrelationOptimizer-2.Examples">2. Examples</h2><p>At first, let's take a look at three examples. For every query, we show the original operator tree generated by Hive and the optimized operator tree. To be concise, we only show the following operators, which are <code>FileSinkOperator (FS)</code>, <code>GroupByOperator (AGG)</code>, <code>HashTableSinkOperator (HT)</code>, <code>JoinOperator (JOIN)</code>, <code>MapJoinOperator (MJ)</code>, and <code>ReduceSinkOperator (RS)</code>. Also, in every query, we add comments (e.g. /*JOIN1*/) to indicate the node in the operator tree that an operation belongs to.</p><h3 id="CorrelationOptimizer-2.1Example1">2.1 Example 1</h3><p><span class="confluence-anchor-link" id="CorrelationOptimizer-example1"></span></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script type="syntaxhighlighter" class="brush: sql; gutter: false; theme: Default"><![CDATA[SELECT tmp1.key, count(*)
FROM (SELECT key, avg(value) AS avg
      FROM t1
      GROUP BY /*AGG1*/ key) tmp1
JOIN /*JOIN1*/ t1 ON (tmp1.key = t2.key)
WHERE t1.value &gt; tmp1.avg
GROUP BY /*AGG2*/ tmp1.key;
]]></script>
</div></div><p>The original operator tree generated by Hive is shown below.</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="300" src="../../download/attachments/34019487/Example1NotOptimized.png@version=1&amp;modificationDate=1378736981000&amp;api=v2" data-image-src="/confluence/download/attachments/34019487/Example1NotOptimized.png?version=1&amp;modificationDate=1378736981000&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="34177453" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="Example1NotOptimized.png" data-base-url="https://cwiki.apache.org/confluence" data-linked-resource-content-type="image/png" data-linked-resource-container-id="34019487" data-linked-resource-container-version="13"></span><br /> <span class="confluence-anchor-link" id="CorrelationOptimizer-figure1"></span><br /> <strong>Figure 1: The original operator tree of Example 1 generated by Hive</strong></p><p>This plan uses three MapReduce jobs to evaluate this query. However, <code>AGG1</code>, <code>JOIN1</code>, and <code>AGG2</code> all require the column <code>key</code> to be the partitioning column for shuffling the data. Thus, we do not need to shuffle the data in the same way three times. We only need to shuffle the data once, and thus a single MapReduce job is needed. The optimized operator tree is shown below.</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="300" src="../../download/attachments/34019487/Example1Optimized.png@version=1&amp;modificationDate=1378736981000&amp;api=v2" data-image-src="/confluence/download/attachments/34019487/Example1Optimized.png?version=1&amp;modificationDate=1378736981000&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="34177454" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="Example1Optimized.png" data-base-url="https://cwiki.apache.org/confluence" data-linked-resource-content-type="image/png" data-linked-resource-container-id="34019487" data-linked-resource-container-version="13"></span><br /> <span class="confluence-anchor-link" id="CorrelationOptimizer-figure2"></span><br /> <strong>Figure 2: The optimized operator tree of Example 1</strong></p><p>Since the input table of <code>AGG1</code> and the left table of <code>JOIN1</code> are both <code>t1</code>, when we use a single MapReduce job to evaluate this query, Hive only needs to scan <code>t1</code> once. While, in the original plan, <code>t1</code> is used in two MapReduce jobs, and thus it is scanned twice.</p><h3 id="CorrelationOptimizer-2.2Example2">2.2 Example 2</h3><p><span class="confluence-anchor-link" id="CorrelationOptimizer-example2"></span></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script type="syntaxhighlighter" class="brush: sql; gutter: false; theme: Default"><![CDATA[SELECT tmp1.key, count(*)
FROM t1
JOIN /*JOIN1*/ (SELECT key, avg(value) AS avg
                FROM t1
                GROUP BY /*AGG1*/ key) tmp1 ON (t1.key = tmp1.key)
JOIN /*JOIN1*/ t2 ON (tmp1.key = t2.key)
WHERE t2.value &gt; tmp1.avg
GROUP BY /*AGG2*/ t1.key;
]]></script>
</div></div><p>The original operator tree generated by Hive is shown below.</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="400" src="../../download/attachments/34019487/Example2NotOptimized.png@version=1&amp;modificationDate=1378736981000&amp;api=v2" data-image-src="/confluence/download/attachments/34019487/Example2NotOptimized.png?version=1&amp;modificationDate=1378736981000&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="34177455" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="Example2NotOptimized.png" data-base-url="https://cwiki.apache.org/confluence" data-linked-resource-content-type="image/png" data-linked-resource-container-id="34019487" data-linked-resource-container-version="13"></span><br /> <span class="confluence-anchor-link" id="CorrelationOptimizer-figure3"></span><br /> <strong>Figure 3: The original operator tree of Example 2 generated by Hive</strong></p><p>This example is similar to Example 1. The optimized operator tree only needs a single MapReduce job, which is shown below.</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="400" src="../../download/attachments/34019487/Example2Optimized.png@version=1&amp;modificationDate=1378736981000&amp;api=v2" data-image-src="/confluence/download/attachments/34019487/Example2Optimized.png?version=1&amp;modificationDate=1378736981000&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="34177456" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="Example2Optimized.png" data-base-url="https://cwiki.apache.org/confluence" data-linked-resource-content-type="image/png" data-linked-resource-container-id="34019487" data-linked-resource-container-version="13"></span><br /> <span class="confluence-anchor-link" id="CorrelationOptimizer-figure4"></span><br /> <strong>Figure 4: The optimized operator tree of Example 2</strong></p><h3 id="CorrelationOptimizer-2.3Example3">2.3 Example 3</h3><p><span class="confluence-anchor-link" id="CorrelationOptimizer-example3"></span></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script type="syntaxhighlighter" class="brush: sql; gutter: false; theme: Default"><![CDATA[SELECT count(distinct ws1.ws_order_number) as order_count,
       sum(ws1.ws_ext_ship_cost) as total_shipping_cost,
       sum(ws1.ws_net_profit) as total_net_profit
FROM web_sales ws1
JOIN /*MJ1*/ customer_address ca ON (ws1.ws_ship_addr_sk = ca.ca_address_sk)
JOIN /*MJ2*/ web_site s ON (ws1.ws_web_site_sk = s.web_site_sk)
JOIN /*MJ3*/ date_dim d ON (ws1.ws_ship_date_sk = d.d_date_sk)
LEFT SEMI JOIN /*JOIN4*/ (SELECT ws2.ws_order_number as ws_order_number
               	          FROM web_sales ws2 JOIN /*JOIN1*/ web_sales ws3
               	          ON (ws2.ws_order_number = ws3.ws_order_number)
               	          WHERE ws2.ws_warehouse_sk &lt;&gt; ws3.ws_warehouse_sk) ws_wh1
ON (ws1.ws_order_number = ws_wh1.ws_order_number)
LEFT SEMI JOIN /*JOIN4*/ (SELECT wr_order_number
               	          FROM web_returns wr
               	          JOIN /*JOIN3*/ (SELECT ws4.ws_order_number as ws_order_number
                                          FROM web_sales ws4 JOIN /*JOIN2*/ web_sales ws5
                                          ON (ws4.ws_order_number = ws5.ws_order_number)
                                          WHERE ws4.ws_warehouse_sk &lt;&gt; ws5.ws_warehouse_sk) ws_wh2
                          ON (wr.wr_order_number = ws_wh2.ws_order_number)) tmp1
ON (ws1.ws_order_number = tmp1.wr_order_number)
WHERE d.d_date &gt;= &#39;2001-05-01&#39; and
      d.d_date &lt;= &#39;2001-06-30&#39; and
      ca.ca_state = &#39;NC&#39; and
      s.web_company_name = &#39;pri&#39;;
]]></script>
</div></div><p>The original operator tree generated by Hive is shown below.</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="500" src="../../download/attachments/34019487/Example3NotOptimized.png@version=1&amp;modificationDate=1378736981000&amp;api=v2" data-image-src="/confluence/download/attachments/34019487/Example3NotOptimized.png?version=1&amp;modificationDate=1378736981000&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="34177457" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="Example3NotOptimized.png" data-base-url="https://cwiki.apache.org/confluence" data-linked-resource-content-type="image/png" data-linked-resource-container-id="34019487" data-linked-resource-container-version="13"></span><br /> <span class="confluence-anchor-link" id="CorrelationOptimizer-figure5"></span><br /> <strong>Figure 5: The original operator tree of Example 3 generated by Hive</strong></p><p>In this complex query, we will first have several MapJoins (<code>MJ1</code>, <code>MJ2</code>, and <code>MJ3</code>) which can be evaluated in the same Map phase. Since <code>JOIN1</code>, <code>JOIN2</code>, <code>JOIN3</code>, and <code>JOIN4</code> use the same column as the join key, we can use a single MapReduce job to evaluate all operators before <code>AGG1</code>. The second MapReduce job will generate the final results. The optimized operator tree is shown below.</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="500" src="../../download/attachments/34019487/Example3Optimized.png@version=1&amp;modificationDate=1378736981000&amp;api=v2" data-image-src="/confluence/download/attachments/34019487/Example3Optimized.png?version=1&amp;modificationDate=1378736981000&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="34177458" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="Example3Optimized.png" data-base-url="https://cwiki.apache.org/confluence" data-linked-resource-content-type="image/png" data-linked-resource-container-id="34019487" data-linked-resource-container-version="13"></span><br /> <span class="confluence-anchor-link" id="CorrelationOptimizer-figure6"></span><br /> <strong>Figure 6: The optimized operator tree of Example 3</strong></p><h2 id="CorrelationOptimizer-3.Intra-queryCorrelations">3. Intra-query Correlations</h2><p>In Hive, a submitted SQL query needs to be evaluated in a distributed system. When evaluating a query, data may need to shuffled sometimes. Based on the nature of different data operations, operators in Hive can be divided to two categories.</p><ol><li>Operators which do not require data shuffling. Examples are <code>TableScanOperator</code>, <code>SelectOperator</code> and <code>FilterOperator</code>.</li><li>Operators which require data shuffling. Examples are <code>GroupByOperator</code> and <code>JoinOperator</code>.</li></ol><p>For an operator requiring data shuffling, Hive will add one or multiple <code>ReduceSinkOperators</code> as parents of this operator (the number of <code>ReduceSinkOperators</code> depends on the number of inputs of the operator requiring data shuffling). Those <code>ReduceSinkOperators</code> form the boundary between the Map phase and Reduce phase. Then, Hive will cut the operator tree to multiple pieces (MapReduce tasks) and each piece can be executed in a MapReduce job.</p><p>For a complex query, it is possible that a input table is used by multiple MapReduce tasks. In this case, this table will be loaded multiple times when the original operator tree is used. Also, when generating those <code>ReduceSinkOperators</code>, Hive does not consider if the corresponding operator requiring data shuffling really needs a re-partitioned input data. For example, in the original operator tree of <a href="Correlation+Optimizer#CorrelationOptimizer-example1">Example 1</a> (<a href="Correlation+Optimizer#CorrelationOptimizer-figure1">Figure 1</a>), <code>AGG1</code>, <code>JOIN1</code>, and <code>AGG2</code> require the data been shuffled in the same way because all of them require the column <code>key</code> to be the partitioning column in their corresponding <code>ReduceSinkOperators</code>. But, Hive is not aware this correlation between <code>AGG1</code>, <code>JOIN1</code>, and <code>AGG2</code>, and still generates three MapReduce tasks.</p><p>Correlation Optimizer aims to exploit two intra-qeury correlations mentioned above.</p><ol><li>Input Correlation: A input table is used by multiple MapReduce tasks in the original operator tree.</li><li>Job Flow Correlation: Two dependent MapReduce tasks shuffle the data in the same way.</li></ol><h2 id="CorrelationOptimizer-4.CorrelationDetection">4. Correlation Detection</h2><p>In Hive, every query has one or multiple terminal operators which are the last operators in the operator tree. Those terminal operators are called FileSinkOperatos. To give an easy explanation, if an operator A is on another operator B's path to a FileSinkOperato, A is the downstream of B and B is the upstream of A.</p><p>For a given operator tree like the one shown in <a href="Correlation+Optimizer#CorrelationOptimizer-figure1">Figure 1</a>, the Correlation Optimizer starts to visit operators in the tree from those FileSinkOperatos in a depth-first way. The tree walker stops at every ReduceSinkOperator. Then, a correlation detector starts to find a correlation from this ReduceSinkOperator and its siblings by finding the furthest correlated upstream ReduceSinkOperators in a recursive way. If we can find any correlated upstream ReduceSinkOperator, we find a correlation. Currently, there are three conditions to determine if a upstream ReduceSinkOperator and an downstream ReduceSinkOperator are correlated, which are</p><ol><li>emitted rows from these two ReduceSinkOperators are sorted in the same way;</li><li>emitted rows from these two ReduceSinkOperators are partitioned in the same way; and</li><li>these ReduceSinkOperators do not have any conflict on the number reducers.</li></ol><p>Interested readers may refer to our <a href="https://svn.apache.org/viewvc/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/optimizer/correlation/CorrelationOptimizer.java?view=log" class="external-link" rel="nofollow">implementation </a>for details.</p><p>During the correlation detection, a JoinOperator or a UnionOperator can introduce branches to the searching path. For a JoinOperator, its parents are all ReduceSinkOperators. When the detector reaches a JoinOperator, it will check if all parents of this JoinOperator are correlated to the downstream ReduceSinkOperator. Because a JoinOperator contains one or multiple 2-way Join operations, for a ReduceSinkOperator, we can determine if another ReduceSinkOperator appearing in the same Join operation is correlated based on the Join type and positions of these ReduceSinkOperators in the Join operation with the following two rules.</p><ol><li>If a ReduceSinkOperator represents the left table of a INNER JOIN, a LEFT OUTER JOIN, or a LEFT SEMI JOIN, the ReduceSinkOperator representing the right table is also considered correlated; and</li><li>If a ReduceSinkOperator represents the right table of a INNER JOIN, or a RIGHT OUTER JOIN, the ReduceSinkOperator representing the left table is also considered correlated.</li></ol><p>With these two rules, we start to analyze those parent ReduceSinkOperators of the JoinOperator from every ReduceSinkOperator which has columns appearing in the join clause and then we can find all correlated ReduceSinkOperators recursively. If we can find that all parent ReduceSinkOperators are correlated from every ReduceSinkOperator which has columns appearing in the join clause, we will continue the correlation detection on this branch. Otherwise, we will determine that none of ReduceSinkOperator for the JoinOperator is correlated and stop the correlation detection on this branch.</p><p>For a UnionOperator, none of its parents will be a ReduceSinkOperator. So, we check if we can find correlated ReduceSinkOperators for every parent branch of this UnionOperator. If any branch does not have a ReduceSinkOperator, we will determine that we do not find any correlated ReduceSinkOperator at parent branches of this UnionOperator.</p><p>During the process of correlation detection, it is possible that the detector can visit a JoinOperator which will be converted to a Map Join later. In this case, the detector stops searching the branch containing this Map Join. For example,<br />in <a href="Correlation+Optimizer#CorrelationOptimizer-figure5">Figure 5</a>, the detector knows that MJ1, MJ2, and MJ3 will be converted to Map Joins.</p><h2 id="CorrelationOptimizer-5.OperatorTreeTransformation">5. Operator Tree Transformation</h2><p>In a correlation, there are two kinds of ReduceSinkOperators. The first kinds of ReduceSinkOperators are at the bottom layer of a query operator tree which are needed to emit rows to the shuffling phase. For example, in <a href="Correlation+Optimizer#CorrelationOptimizer-figure1">Figure 1</a>, RS1 and RS3 are bottom layer ReduceSinkOperators. The second kinds of ReduceSinkOperators are unnecessary ones which can be removed from the optimized operator tree. For example, in <a href="Correlation+Optimizer#CorrelationOptimizer-figure1">Figure 1</a>, RS2 and RS4 are unnecessary ReduceSinkOperators. Because the input rows of the Reduce phase may need to be forwarded to different operators and those input rows are coming from a single stream, we add a new operator called DemuxOperator to dispatch input rows of the Reduce phase to corresponding operators. In the operator tree transformation, we first connect children of those bottom layer ReduceSinkOperators to the DemuxOperator and reassign tags of those bottom layer ReduceSinkOperators (the DemuxOperator is the only child of those bottom layer ReduceSinkOperators). In the DemuxOperator, we record two mappings. The first one is called newTagToOldTag which maps those new tags assigned to those bottom layer ReduceSinkOperators to their original tags. Those original tags are needed to make JoinOperator work correctly. The second mapping is called newTagToChildIndex which maps those new tags to the children indexes. With this mapping, the DemuxOperator can know the correct operator that a row needs to be forwarded based on the tag of this row. The second step of operator tree transformation is to remove those unnecessary ReduceSinkOperators. To make the operator tree in the Reduce phase work correctly, we add a new operator called MuxOperator to the original place of those unnecessary ReduceSinkOperators. It is worth noting that if an operator has multiple unnecessary ReduceSinkOperators as its parents, we only add a single MuxOperator.</p><h2 id="CorrelationOptimizer-6.ExecutingOptimizedOperatorTreeintheReducePhase">6. Executing Optimized Operator Tree in the Reduce Phase</h2><p>In the Reduce phase, the ExecReducer will forward all reduce input rows to DemuxOperator first. Currently, blocking operators in the reduce phase operator tree share the same keys. Other cases will be supported in future work. Then, DemuxOperator will forward rows to their corresponding operators. Because a Reduce plan optimized Correlation Optimizer can be a tree structure, we need to coordinate operators in this tree to make the Reduce phase work correctly. This coordination mechanism is implemented in ExecDriver, DemuxOperator and MuxOperator.</p><p>When a new row is sent to the ExecDriver, it checks if it needs to start a new group of rows by checking values of those key columns. If a new group of rows is coming, it first invokes DemuxOperator.endGroup. Then, the DemuxOperator will ask its children to process their buffered rows and propagate the endGroup call to the operator tree. Finally, DemuxOperator will propagate processGroup call to the operator tree. Usually, the implementation of processGroup in an operator only propagates this call to its children. MuxOperator is the one that overrides processGroup. When a MuxOperator gets the processGroup call, it <span style="font-size: 14.0px;line-height: 1.4285715;">check if all its parent operators have invoked this call. If so, it will ask its child to generate results and propagate processGroup to its child. Once the processGroup has been propagated to all operators, the DemuxOperator.endGroup will return and ExecDriver will propagate startGroup to the operator tree.</span></p><p><span style="font-size: 14.0px;line-height: 1.4285715;">For every row sent to the ExecDriver, it also has a tag assigned by a corresponding RediceSinkOperator at the Map phase. In a row group (rows having the same key), rows are also sorted by their tags. When the DemuxOperator sees a new tag coming, it knows all child operators associated with tags smaller than this new coming tag will not have any input within the current row group. Thus, it can call endGroup and processGroup of </span><span style="font-size: 14.0px;line-height: 1.4285715;">those operators earlier. With this logic, within a row group, the input rows of every operator in the operator tree are also ordered by tags, which is required by JoinOperator. This logic also makes rows in the buffer of an operator be emitted as quickly as possible, which avoids unnecessary memory footprint contributed from buffering unnecessary rows.</span></p><h2 id="CorrelationOptimizer-7.RelatedJiras">7. Related Jiras</h2><p>The umbrella jira is <a href="https://issues.apache.org/jira/browse/HIVE-3667" class="external-link" rel="nofollow">HIVE-3667</a>.</p><h3 id="CorrelationOptimizer-7.1ResolvedJiras">7.1 Resolved Jiras</h3><ul><li><a href="https://issues.apache.org/jira/browse/HIVE-1772" class="external-link" rel="nofollow">HIVE-1772</a></li><li><a href="https://issues.apache.org/jira/browse/HIVE-2206" class="external-link" rel="nofollow">HIVE-2206</a></li><li><a href="https://issues.apache.org/jira/browse/HIVE-3430" class="external-link" rel="nofollow">HIVE-3430</a></li><li><a href="https://issues.apache.org/jira/browse/HIVE-3670" class="external-link" rel="nofollow">HIVE-3670</a></li><li><a href="https://issues.apache.org/jira/browse/HIVE-3671" class="external-link" rel="nofollow">HIVE-3671</a></li><li><a href="https://issues.apache.org/jira/browse/HIVE-4952" class="external-link" rel="nofollow">HIVE-4952</a></li><li><a href="https://issues.apache.org/jira/browse/HIVE-4972" class="external-link" rel="nofollow">HIVE-4972</a></li></ul><h3 id="CorrelationOptimizer-7.2UnresolvedJiras">7.2 Unresolved Jiras</h3><ul><li><a href="https://issues.apache.org/jira/browse/HIVE-3668" class="external-link" rel="nofollow">HIVE-3668</a></li><li><a href="https://issues.apache.org/jira/browse/HIVE-3669" class="external-link" rel="nofollow">HIVE-3669</a></li><li><a href="https://issues.apache.org/jira/browse/HIVE-3773" class="external-link" rel="nofollow">HIVE-3773</a></li><li><a href="https://issues.apache.org/jira/browse/HIVE-4751" class="external-link" rel="nofollow">HIVE-4751</a></li></ul><h2 id="CorrelationOptimizer-8.References">8. References</h2><ol><li>Rubao Lee, Tian Luo, Yin Huai, Fusheng Wang, Yongqiang He, Xiaodong Zhang. <a href="http://www.cse.ohio-state.edu/hpcs/WWW/HTML/publications/papers/TR-11-7.pdf" class="external-link" rel="nofollow">YSmart: Yet another SQL-to-MapReduce Translator</a>, ICDCS, 2011</li></ol>

                
        
    
        </div>

        <!--
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
         xmlns:dc="http://purl.org/dc/elements/1.1/"
         xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
         <rdf:Description
    rdf:about="https://cwiki.apache.org/confluence/display/Hive/Correlation+Optimizer"
    dc:identifier="https://cwiki.apache.org/confluence/display/Hive/Correlation+Optimizer"
    dc:title="Correlation Optimizer"
    trackback:ping="https://cwiki.apache.org/confluence/rpc/trackback/34019487"/>
</rdf:RDF>
-->

                        
    



<div id="labels-section" class="pageSection group">
    <div class="labels-section-content content-column" entityid="34019487" entitytype="page">
	<div class="labels-content">
		
    <ul class="label-list label-list-right ">
            <li class="no-labels-message">
            No labels
        </li>
            </ul>

    </div>
</div>
</div>
        
		
            




            
    








                        
    
<div id="comments-section" class="pageSection group">
        
    



</div>


                
    
            
</div>


    




    
    

    
    
    


    
<div id="space-tools-web-items" class="hidden">
                <div data-label="Overview" data-href="/confluence/spaces/viewspacesummary.action?key=Hive">Overview</div>
            <div data-label="Content Tools" data-href="/confluence/pages/reorderpages.action?key=Hive">Content Tools</div>
            <div data-label="Add-ons" data-href="/confluence/spaces/snippeterrors.action?key=Hive">Add-ons</div>
    </div>




    </div><!-- \#main -->
        
    
        
            
            

<div id="footer" role="contentinfo">
    <section class="footer-body">

                                                            <p class="license license-opensource">
                    Powered by a free <b>Atlassian Confluence Open Source Project License</b> granted to Apache Software Foundation. <a href="http://www.atlassian.com/c/conf/11461">Evaluate Confluence today</a>.<br>
                </p>
                    
        

        <ul id="poweredby">
            <li class="noprint">Powered by <a href="http://www.atlassian.com/software/confluence" class="hover-footer-link">Atlassian Confluence</a> <span id='footer-build-information'>5.8.4</span>, <a href="http://www.atlassian.com/software/confluence/overview/team-collaboration-software?utm_source=confluence-footer" class="hover-footer-link">Team Collaboration Software</a></li>
            <li class="print-only">Printed by Atlassian Confluence 5.8.4, Team Collaboration Software.</li>
            <li class="noprint"><a href="https://jira.atlassian.com/browse/CONF" class="hover-footer-link">Report a bug</a></li>
            <li class="noprint"><a href="http://www.atlassian.com/about/connected.jsp?s_kwcid=Confluence-stayintouch" class="hover-footer-link">Atlassian News</a></li>
        </ul>

        

        <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>

                    
        
    </section>
</div>

    
</div>

</div><!-- \#full-height-container -->
</div><!-- \#page -->
</body>
</html>
