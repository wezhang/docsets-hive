<!DOCTYPE html>
<html>
<head>
                    <title>Hive on Spark: Getting Started - Apache Hive - Apache Software Foundation</title>
    
        

                        
    
                        
    

                
    
    <meta http-equiv="X-UA-Compatible" content="IE=EDGE,chrome=IE7">
<meta charset="UTF-8">
<meta id="confluence-context-path" name="confluence-context-path" content="/confluence">
<meta id="confluence-base-url" name="confluence-base-url" content="https://cwiki.apache.org/confluence">

<meta id="atlassian-token" name="atlassian-token" content="735c8f668271f8e1dea73527ae5689ca93f07505">


<meta id="confluence-space-key" name="confluence-space-key" content="Hive">
<script type="text/javascript">
        var contextPath = '/confluence';
</script>

    

    <meta name="confluence-request-time" content="1451833167576">
        
    
        
            <meta name="ajs-is-space-admin" content=""> <meta name="ajs-has-space-config" content="">
            <style>.ia-fixed-sidebar, .ia-splitter-left {width: 285px;}.theme-default .ia-splitter #main {margin-left: 285px;}.ia-fixed-sidebar {visibility: hidden;}</style>
            <meta name="ajs-use-keyboard-shortcuts" content="true">
            <meta name="ajs-discovered-plugin-features" content="$discoveredList">
            <meta name="ajs-keyboardshortcut-hash" content="38450baaed51271899c8e867d2a48ca9">
            <meta name="ajs-is-confluence-admin" content="false">
            <meta name="ajs-connection-timeout" content="10000">
            <meta name="gliffy-license-type" content="LicenseType&lt;COMMUNITY&gt;">
<meta name="gliffy-license-quantity" content="${pluginLicenseManager.userCount}">

            <script type="text/x-template" title="gliffy-webpanel-footer">
        <div class="gliffy-webpanel-footer"><span>This Confluence installation runs a Free Gliffy License - Evaluate the <a href="http://www.gliffy.com/products/confluence-plugin/">Gliffy Confluence Plugin</a> for your Wiki!</span></div>
</script>


            
    
    
            <meta name="ajs-page-id" content="44302539">
            <meta name="ajs-latest-page-id" content="44302539">
            <meta name="ajs-content-type" content="page">
            <meta name="ajs-page-title" content="Hive on Spark: Getting Started">
            <meta name="ajs-parent-page-title" content="Home">
            <meta name="ajs-parent-page-id" content="27362069">
            <meta name="ajs-space-key" content="Hive">
            <meta name="ajs-space-name" content="Apache Hive">
            <meta name="ajs-jira-metadata-count" content="0">
            <meta name="ajs-from-page-title" content="">
            <meta name="ajs-can-remove-page" content="false">
            <meta name="ajs-browse-page-tree-mode" content="view">
            <meta name="ajs-shared-drafts" content="false">
            <meta name="ajs-context-path" content="/confluence">
            <meta name="ajs-base-url" content="https://cwiki.apache.org/confluence">
            <meta name="ajs-version-number" content="5.8.4">
            <meta name="ajs-build-number" content="5982">
            <meta name="ajs-remote-user" content="">
            <meta name="ajs-remote-user-key" content="">
            <meta name="ajs-current-user-fullname" content="">
            <meta name="ajs-current-user-avatar-url" content="">
            <meta name="ajs-static-resource-url-prefix" content="/confluence/s/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/_">
            <meta name="ajs-global-settings-attachment-max-size" content="20971520">
            <meta name="ajs-user-locale" content="en_GB">
            <meta name="ajs-enabled-dark-features" content="confluence-inline-comments-resolved,notification.plugin.api.enabled.com.atlassian.confluence.plugins.sharepage.api.ShareContentEvent,notification.plugin.api.enabled.com.atlassian.confluence.plugins.mentions.api.ConfluenceMentionEvent,notification.plugin.api.enabled.com.atlassian.confluence.event.events.security.ForgotPasswordEvent,pdf-preview,notification.plugin.api.enabled.com.atlassian.confluence.plugins.tasklist.event.SendTaskEmailEvent,notification.plugin.api.enabled.com.atlassian.confluence.event.events.content.page.async.PageMovedEvent,previews.sharing,previews.versions,notification.plugin.api.enabled.com.atlassian.confluence.plugins.files.notifications.event.FileContentUpdateEvent,file-annotations,notification.plugin.api.enabled.com.atlassian.confluence.event.events.content.attachment.AttachmentBatchUploadCompletedEvent,notification.plugin.api.enabled.com.atlassian.confluence.event.events.content.comment.CommentCreateEvent,notification.plugin.api.enabled.com.atlassian.confluence.efi.emails.events.OnboardingLessUsersEvent,notification.plugin.api.enabled.com.atlassian.confluence.plugins.files.notifications.event.FileContentRemoveEvent,atlassian.aui.raphael.disabled,previews.conversion-service,notification.plugin.api.enabled.com.atlassian.confluence.event.events.content.comment.CommentUpdateEvent,notification.plugin.api.enabled.com.atlassian.confluence.event.events.follow.FollowEvent,notification.plugin.api.enabled.com.atlassian.confluence.event.events.content.page.async.PageEditedEvent,notification.plugin.api.enabled.com.atlassian.confluence.event.events.content.blogpost.BlogPostCreateEvent,previews.trigger-all-file-types,notification.plugin.api.enabled.com.atlassian.confluence.plugins.inlinecomments.events.InlineCommentResolveEvent,notification.plugin.api.enabled.com.atlassian.confluence.event.events.like.LikeCreatedEvent,notification.plugin.api.enabled.com.atlassian.confluence.plugins.inlinecomments.events.InlineCommentCreateEvent,previews.sharing.pushstate,confluence-inline-comments-rich-editor,notification.plugin.api.enabled.com.atlassian.confluence.event.events.content.blogpost.BlogPostUpdateEvent,file-annotations.likes,notification.plugin.api.enabled.com.atlassian.confluence.event.events.content.page.async.PageCreatedEvent,notification.plugin.api.enabled.com.atlassian.confluence.plugins.files.notifications.event.FileContentMentionUpdateEvent,notification.plugin.api.enabled.com.atlassian.confluence.efi.emails.events.OnboardingNoSpaceCreatedEvent,notification.plugin.api.enabled.com.atlassian.confluence.plugins.hipchat.api.events.HipChatUserMapped,notification.plugin.api.enabled.com.atlassian.confluence.plugins.sharepage.api.ShareAttachmentEvent,confluence-inline-comments,confluence-inline-comments-dangling-comment,notification.plugin.api.enabled.com.atlassian.confluence.event.events.content.blogpost.BlogPostMovedEvent">
            <meta name="ajs-atl-token" content="735c8f668271f8e1dea73527ae5689ca93f07505">
            <meta name="ajs-confluence-flavour" content="VANILLA">
            <meta name="ajs-user-date-pattern" content="dd MMM yyyy">
            <meta name="ajs-date.format" content="MMM dd, yyyy">
    
    <link rel="shortcut icon" href="../../s/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/_/favicon.ico">
    <link rel="icon" type="image/x-icon" href="../../s/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/_/favicon.ico">

<link rel="search" type="application/opensearchdescription+xml" href="https://cwiki.apache.org/confluence/opensearch/osd.action" title="Apache Software Foundation"/>
    
                    
            <meta name="ajs-create-issue-metadata-show-discovery" content="false">
            

<script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path.context-path"]="\"/confluence\"";
WRM._unparsedData["com.atlassian.plugins.atlassian-nps-plugin:atlassian-nps-plugin-resources.is-server-instance-data-provider"]="true";
WRM._unparsedData["com.atlassian.plugins.browser.metrics.browser-metrics-plugin:browser-metrics.feature-data-provider-legacy"]="true";
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-rest:web-resource-manager.resource-base-url-pattern"]="\"(?:/confluence(?:/s/.*?/_)?/download)\"";
WRM._unparsedData["com.atlassian.confluence.plugins.confluence-license-banner:confluence-license-banner-resources.license-details"]="{\"daysBeforeLicenseExpiry\":0,\"daysBeforeMaintenanceExpiry\":0,\"showLicenseExpiryBanner\":false,\"showMaintenanceExpiryBanner\":false,\"renewUrl\":null,\"salesEmail\":null}";
WRM._unparsedData["com.atlassian.confluence.plugins.confluence-hipchat-integration-plugin:discovery-javascript-data.link-active"]="{\"linkActive\":true,\"conditionsMet\":true,\"admin\":false}";
WRM._unparsedData["com.atlassian.plugins.atlassian-nps-plugin:nps-acknowledgement-resources.analytics-enabled-data-provider"]="\"true\"";
WRM._unparsedData["com.atlassian.plugins.atlassian-nps-plugin:nps-acknowledgement-resources.sen-data-provider"]="\"SEN-2015076\"";
WRM._unparsedData["com.atlassian.confluence.plugins.confluence-feature-discovery-plugin:confluence-feature-discovery-plugin-resources.test-mode"]="false";
WRM._unparsedData["com.atlassian.plugins.browser.metrics.browser-metrics-plugin:api.feature-data-provider"]="true";
</script>
<link type="text/css" rel="stylesheet" href="../../s/2e51e60e83eadbb79c5004bd9c4ac765-CDN/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/68/_/download/superbatch/css/batch.css@build-number=5982" media="all">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/confluence/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/68/_/download/superbatch/css/batch.css?conditionalComment=lt+IE+9" media="all">
<![endif]-->
<!--[if lte IE 9]>
<link type="text/css" rel="stylesheet" href="/confluence/s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/68/_/download/superbatch/css/batch.css?conditionalComment=lte+IE+9" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/9b6bdeb7fddc0a2f5337e313f4e85615-T/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/ec13b76cd8d002fa2cf4ca229002aee7/_/download/contextbatch/css/page,viewcontent,atl.general,main,pagebanner,atl.comments/batch.css@highlightactions=true&amp;locale=en-GB&amp;flavour=VANILLA" media="all">
<!--[if lt IE 9]>
<link type="text/css" rel="stylesheet" href="/confluence/s/6c0981174e94142364564819dc0d1413-CDN/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/ec13b76cd8d002fa2cf4ca229002aee7/_/download/contextbatch/css/page,viewcontent,atl.general,main,pagebanner,atl.comments/batch.css?conditionalComment=lt+IE+9&amp;locale=en-GB" media="all">
<![endif]-->
<link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/2.8.6/_/download/batch/org.randombits.confluence.toc%253Atoc-plugin-styles/org.randombits.confluence.toc%253Atoc-plugin-styles.css" media="all">
<link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/2.1.5/_/download/batch/com.atlassian.confluence.ext.newcode-macro-plugin%253Asyntaxhighlighter/com.atlassian.confluence.ext.newcode-macro-plugin%253Asyntaxhighlighter.css" media="all">
<link type="text/css" rel="stylesheet" href="../../s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/2.1.5/_/download/batch/com.atlassian.confluence.ext.newcode-macro-plugin%253Ash-theme-default/com.atlassian.confluence.ext.newcode-macro-plugin%253Ash-theme-default.css" media="all">
<link type="text/css" rel="stylesheet" href="../../s/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/13/_/styles/colors.css@spaceKey=Hive" media="all">
<link type="text/css" rel="stylesheet" href="../../s/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/1.0/_/download/resources/com.atlassian.confluence.themes.default%253Astyles/default-theme.css" media="all">
<script type="text/javascript" src="../../s/b5b7f3c4a47ebde54b884c3070e3bb8c-CDN/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/68/_/download/superbatch/js/batch.js@atlassian.aui.raphael.disabled=true&amp;locale=en-GB&amp;build-number=5982" ></script>
<script type="text/javascript" src="../../s/47fb273cd38c3662368839aefb134f70-T/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/ec13b76cd8d002fa2cf4ca229002aee7/_/download/contextbatch/js/page,viewcontent,atl.general,main,pagebanner,atl.comments/batch.js@highlightactions=true&amp;analytics-uploadable=true&amp;flavour=VANILLA&amp;nps-acknowledged=true&amp;analytics-enabled=true&amp;locale=en-GB&amp;anonymous-access-enabled=true&amp;is-server-instance=true&amp;hostenabled=true" ></script>
<script type="text/javascript" src="../../s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/2.8.6/_/download/batch/org.randombits.confluence.toc%253Aclient-side-toc-resources/org.randombits.confluence.toc%253Aclient-side-toc-resources.js" ></script>
<script type="text/javascript" src="../../s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/2.8.6/_/download/batch/org.randombits.confluence.toc%253Atoc-plugin-analytics/org.randombits.confluence.toc%253Atoc-plugin-analytics.js" ></script>
<script type="text/javascript" src="../../s/6c0981174e94142364564819dc0d1413-CDN/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/2.1.5/_/download/batch/com.atlassian.confluence.ext.newcode-macro-plugin%253Asyntaxhighlighter/com.atlassian.confluence.ext.newcode-macro-plugin%253Asyntaxhighlighter.js@locale=en-GB" ></script>
<script type="text/javascript" src="../../s/d41d8cd98f00b204e9800998ecf8427e-CDN/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/2.1.5/_/download/batch/com.atlassian.confluence.ext.newcode-macro-plugin%253Asyntaxhighlighter-brushes/com.atlassian.confluence.ext.newcode-macro-plugin%253Asyntaxhighlighter-brushes.js" ></script>


        
    

        
        <meta name="ajs-site-title" content="Apache Software Foundation" />

    
    

    
                <link rel="canonical" href="Hive+on+Spark%253A+Getting+Started">
        <link rel="shortlink" href="https://cwiki.apache.org/confluence/x/ywCkAg">
    <meta name="wikilink" content="[Hive:Hive on Spark: Getting Started]">
    <meta name="page-version" content="89">

</head>

<body             onload="placeFocus()"
     id="com-atlassian-confluence" class="theme-default  aui-layout aui-theme-default">

        
            <div id='stp-licenseStatus-banner'></div>
    <ul id="assistive-skip-links" class="assistive">
    <li><a href="Hive+on+Spark%253A+Getting+Started#title-heading">Skip to content</a></li>
    <li><a href="Hive+on+Spark%253A+Getting+Started#breadcrumbs">Skip to breadcrumbs</a></li>
    <li><a href="Hive+on+Spark%253A+Getting+Started#header-menu-bar">Skip to header menu</a></li>
    <li><a href="Hive+on+Spark%253A+Getting+Started#navigation">Skip to action menu</a></li>
    <li><a href="Hive+on+Spark%253A+Getting+Started#quick-search-query">Skip to quick search</a></li>
</ul>
<div id="page">
<div id="full-height-container">
    <div id="header-precursor">
        <div class="cell">
            <style type="text/css">
#preview #previewArea iframe {

   overflow: visible;
}
</style>

                            </div>
    </div>
    



<header id="header" role="banner">
    <nav class="aui-header aui-dropdown2-trigger-group" role="navigation"><div class="aui-header-inner"><div class="aui-header-before"><a class=" aui-dropdown2-trigger app-switcher-trigger" aria-owns="app-switcher" aria-controls="app-switcher" aria-haspopup="true" data-aui-trigger href="Hive+on+Spark%253A+Getting+Started#app-switcher"><span class="aui-icon aui-icon-small aui-iconfont-appswitcher">Linked Applications</span></a><div id="app-switcher" class="aui-dropdown2 aui-style-default"><div class="app-switcher-loading">Loading&hellip;</div></div><script>
            (function (NL) {
                var initialise = function () {
                    // For some milestones of AUI, the atlassian soy namespace was renamed to aui. Handle that here by ensuring that window.atlassian is defined.
                    window.atlassian = window.atlassian || window.aui;
                    new NL.AppSwitcher({
                        dropdownContents: '#app-switcher'
                    });
                };
                if (NL.AppSwitcher) {
                    initialise();
                } else {
                    NL.onInit = initialise;
                }
            }(window.NL = (window.NL || {})));
            window.NL.isUserAdmin = false</script></div><div class="aui-header-primary"><h1 id="logo" class="aui-header-logo aui-header-logo-custom"><a href="https://cwiki.apache.org/confluence/"><img src="../../s/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/_/images/logo/confluence-logo.png" alt="Apache Software Foundation" /></a></h1><ul class="aui-nav">
                            <li>
            
        
        
<a  id="space-directory-link" href="https://cwiki.apache.org/confluence/spacedirectory/view.action"  class=" aui-nav-imagelink"   title="Spaces">
            <span>Spaces</span>
    </a>
        </li>
                        </ul>
</div><div class="aui-header-secondary"><ul class="aui-nav">
                        <li>
        <form id="quick-search" class="aui-quicksearch dont-default-focus header-quicksearch" action="https://cwiki.apache.org/confluence/dosearchsite.action" method="get"><fieldset><label for="quick-search-query" class="assistive">Quick Search</label><input id="quick-search-query" class="text app-search search quick-search-query" type="text" accessKey="q" autocomplete="off" name="queryString" title="Quick Search" placeholder="Search" /><input id="quick-search-submit" class="quick-search-submit" type="submit" value="Search"/><div class="aui-dd-parent quick-nav-drop-down"></div></fieldset></form>
    </li>
        <li>
            
        <a id="help-menu-link" class="aui-nav-link aui-dropdown2-trigger" href="Hive+on+Spark%253A+Getting+Started#" aria-haspopup="true" aria-owns="help-menu-link-content" title="Help">
        <span class="aui-icon aui-icon-small aui-iconfont-help">Help</span>
    </a>
    <nav id="help-menu-link-content" class="aui-dropdown2 aui-style-default" aria-hidden="true">
                    <div class="aui-dropdown2-section">
                                <ul  id="help-menu-link-leading" class="aui-list-truncate section-leading first">
                                            <li>
        
            
<a  id="confluence-help-link" href="https://docs.atlassian.com/confluence/docs-58/Getting+Help+And+Support" class="    "      title="Visit the Confluence documentation home"  target="_blank"
>
        Online Help
</a>
</li>
                                            <li>
    
            
<a  id="keyboard-shortcuts-link" href="https://cwiki.apache.org/confluence" class="    "      title="View available keyboard shortcuts" >
        Keyboard Shortcuts
</a>
</li>
                                            <li>
    
            
<a  id="feed-builder-link" href="https://cwiki.apache.org/confluence/dashboard/configurerssfeed.action" class="    "      title="Create your custom RSS feed." >
        Feed Builder
</a>
</li>
                                            <li>
    
            
<a  id="whats-new-menu-link" href="https://docs.atlassian.com/confluence/docs-58/whatsnew/iframe" class="    "      title="" >
        What’s new
</a>
</li>
                                            <li>
    
            
<a  id="whats-new-menu-link" href="https://docs.atlassian.com/confluence/docs-58/whatsnew/iframe" class="    "      title="" >
        What’s new
</a>
</li>
                                            <li>
    
            
<a  id="gadget-directory-link" href="https://cwiki.apache.org/confluence" class="   user-item administration-link "      title="Browse gadgets provided by Confluence" >
        Available Gadgets
</a>
</li>
                                            <li>
    
            
<a  id="confluence-about-link" href="https://cwiki.apache.org/confluence/aboutconfluencepage.action" class="    "      title="Get more information about Confluence" >
        About Confluence
</a>
</li>
                                    </ul>
            </div>
            </nav>
    
    </li>
        <li>
                
    
    </li>
        <li>
            
    </li>
        <li>
                                            <li>
        
            
<a  id="login-link" href="https://cwiki.apache.org/confluence/login.action?os_destination=%2Fdisplay%2FHive%2FHive%2Bon%2BSpark%3A%2BGetting%2BStarted" class="   user-item login-link "      title="" >
        Log in
</a>
</li>
                        <li>
    
            
<a  id="signup-link" href="https://cwiki.apache.org/confluence/signup.action" class="   user-item signup-link "      title="" >
        Sign up
</a>
</li>
                        
    </li>
    </ul>
</div></div><!-- .aui-header-inner--></nav><!-- .aui-header -->
    <br class="clear">
</header>

    
    	<div class="ia-splitter">
    		<div class="ia-splitter-left">
    			<div class="ia-fixed-sidebar">
    				
	    	<div class="acs-side-bar ia-scrollable-section"><div class="acs-side-bar-space-info tipsy-enabled" data-configure-tooltip="Edit space details"><div class="avatar"><div class="space-logo " data-key="Hive" data-name="Apache Hive" data-entity-type="confluence.space"><div class="avatar-img-container"><div class="avatar-img-wrapper"><a href="https://cwiki.apache.org/confluence/display/Hive" title="Apache Hive"><img class="avatar-img" src="../../download/attachments/27362113/Hive@version=2&amp;modificationDate=1317659390000&amp;api=v2" alt="Apache Hive"></a></div></div></div></div><div class="name"><a href="https://cwiki.apache.org/confluence/display/Hive" title="Apache Hive">Apache Hive</a></div><div class="flyout-handle icon"></div></div><div class="acs-side-bar-content"><div class="acs-nav-wrapper"><div class="acs-nav" data-has-create-permission="false" data-quick-links-state="null" data-nav-type="pages"><div class="acs-nav-sections"><div class="main-links-section "><ul class="acs-nav-list"><li class="acs-nav-item wiki current-item"data-collector-key="spacebar-pages"><a class="acs-nav-item-link tipsy-enabled" href="https://cwiki.apache.org/confluence/collector/pages.action?key=Hive" data-collapsed-tooltip="Pages"><span class="icon"></span><span class="acs-nav-item-label">Pages</span></a></li><li class="acs-nav-item blog"data-collector-key="spacebar-blogs"><a class="acs-nav-item-link tipsy-enabled" href="https://cwiki.apache.org/confluence/pages/viewrecentblogposts.action?key=Hive" data-collapsed-tooltip="Blog"><span class="icon"></span><span class="acs-nav-item-label">Blog</span></a></li></ul></div><div class="quick-links-wrapper"></div></div></div></div><div class="ia-secondary-container tipsy-enabled" data-tree-type="pages"><div class="ia-secondary-header"><h5 class="ia-secondary-header-title pages"><span class="label">Child pages</span></h5></div><div class="ia-secondary-parent-content"><ul class="parent ia-secondary-header-title wiki"><li class="parent-item"><a class="parent-item-link" href="Home" title="Home"><span class="icon"></span><span class="label">Home</span></a></li></ul></div><div class="ia-secondary-current-content"><ul class="ia-secondary-currentPage-title wiki current-item"><li><span class="icon"></span><span class="label">Hive on Spark: Getting Started</span></li></ul></div><div class="ia-secondary-content"><div class="contextual-nav-child-pages"></div></div></div></div><div class="hidden"><a href="https://cwiki.apache.org/confluence/collector/pages.action?key=Hive" id="space-pages-link"></a><script type="text/x-template" title="logo-config-content"><h2>Space Details</h2><div class="personal-space-logo-hint">Your profile picture is used as the logo for your personal space. <a href="https://cwiki.apache.org/confluence/users/profile/editmyprofilepicture.action" target="_blank">Change your profile picture</a>.</div></script></div></div><div class="space-tools-section"><div id="space-tools-menu-additional-items" class="hidden"><div data-label="Browse pages" data-class="" data-href="/confluence/pages/reorderpages.action?key=Hive">Browse pages</div></div><div id="space-tools-dd-dummy"></div><a id="space-tools-menu-trigger" class="aui-button aui-button-subtle aui-dropdown2-trigger tipsy-enabled" aria-owns="space-tools-dd-dummy"><span class="aui-icon aui-icon-small aui-iconfont-configure">Configure</span><span class="label">Space tools</span></a><a class="expand-collapse-trigger"></a></div>
    
    			</div>
    		</div>
        <!-- \#header -->

        
        <div id="main" class=" aui-page-panel">
                <div id="main-header">
            
    <div id="navigation" class="content-navigation view">
                    <ul class="ajs-menu-bar">
                                                        
                    
        <li class="normal ajs-menu-item">
        <a id="action-menu-link" class="action aui-dropdown2-trigger-arrowless aui-button aui-button-subtle ajs-menu-title aui-dropdown2-trigger" href="Hive+on+Spark%253A+Getting+Started#" aria-haspopup="true" aria-owns="action-menu" data-container="#navigation">
            <span>
                                    <span class="aui-icon aui-icon-small aui-iconfont-more"></span>
                                
            </span>
        </a>         <div id="action-menu" class="aui-dropdown2 aui-style-default">
                            <ul  id="action-menu-primary"                     class="section-primary first aui-dropdown2-section">
                                            <li>

    
        
                                            
    
    
    <a  id="view-attachments-link" href="https://cwiki.apache.org/confluence/pages/viewpageattachments.action?pageId=44302539" rel="nofollow" class="action-view-attachments"  accessKey="t"  title="View Attachments">
                <span>
                        A<u>t</u>tachments (1)
        </span>    </a>
</li>
                                        <li>

    
        
                                            
    
    
    <a  id="action-view-history-link" href="https://cwiki.apache.org/confluence/pages/viewpreviousversions.action?pageId=44302539" rel="nofollow" class="action-view-history"   title="">
                <span>
                        Page History
        </span>    </a>
</li>
                                        <li>

    
        
                                            
    
    
    <a  id="action-page-permissions-link" href="https://cwiki.apache.org/confluence/pages/viewinfo.action?pageId=44302539" rel="nofollow" class="action-page-permissions"   title="Edit restrictions">
                <span>
                        Restrictions
        </span>    </a>
</li>
                                </ul>
                            <ul  id="action-menu-secondary"                     class="section-secondary aui-dropdown2-section">
                                            <li>

    
        
                                            
    
    
    <a  id="view-page-info-link" href="https://cwiki.apache.org/confluence/pages/viewinfo.action?pageId=44302539" rel="nofollow" class="action-view-info"   title="">
                <span>
                        Page Information
        </span>    </a>
</li>
                                        <li>

    
        
                                            
    
    
    <a  id="view-resolved-comments" href="https://cwiki.apache.org/confluence" rel="nofollow" class=""   title="">
                <span>
                        Resolved comments
        </span>    </a>
</li>
                                        <li>

    
        
                                            
    
    
    <a  id="link-to-page-link" href="https://cwiki.apache.org/confluence/pages/viewinfo.action?pageId=44302539" rel="nofollow" class=""   title="Link to this Page">
                <span>
                        Link to this Page…
        </span>    </a>
</li>
                                        <li>

    
        
                                            
    
    
    <a  id="view-in-hierarchy-link" href="https://cwiki.apache.org/confluence/pages/reorderpages.action?key=Hive&amp;openId=44302539#selectedPageInHierarchy" rel="nofollow" class=""   title="">
                <span>
                        View in Hierarchy
        </span>    </a>
</li>
                                        <li>

    
        
                                            
    
    
    <a  id="action-view-source-link" href="https://cwiki.apache.org/confluence/plugins/viewsource/viewpagesrc.action?pageId=44302539" rel="nofollow" class="action-view-source popup-link"   title="">
                <span>
                        View Source
        </span>    </a>
</li>
                                        <li>

    
        
                                            
    
    
    <a  id="delete-all-comments-link-link" href="https://cwiki.apache.org/confluence/plugins/aptis/deleteAllComments/ask-user.action?pageId=44302539" rel="nofollow" class=""   title="">
                <span>
                        Delete comments
        </span>    </a>
</li>
                                        <li>

    
        
                                            
    
    
    <a  id="action-export-pdf-link" href="https://cwiki.apache.org/confluence/spaces/flyingpdf/pdfpageexport.action?pageId=44302539" rel="nofollow" class=""   title="">
                <span>
                        Export to PDF
        </span>    </a>
</li>
                                        <li>

    
        
                                            
    
    
    <a  id="com-k15t-confluence-scroll-epub-launcher" href="https://cwiki.apache.org/confluence/pages/viewpage.action?pageId=44302539" rel="nofollow" class=""   title="">
                <span>
                        Export to EPUB
        </span>    </a>
</li>
                                        <li>

    
        
                                            
    
    
    <a  id="action-export-word-link" href="https://cwiki.apache.org/confluence/exportword?pageId=44302539" rel="nofollow" class="action-export-word"   title="">
                <span>
                        Export to Word
        </span>    </a>
</li>
                                </ul>
                            <ul  id="action-menu-modify"                     class="section-modify aui-dropdown2-section">
                                            <li>

    
        
                                            
    
    
    <a  id="treecopy-action" href="https://cwiki.apache.org/confluence/plugins/treecopy/setnames.action?pageId=44302539" rel="nofollow" class=""   title="">
                <span>
                        Copy Page Tree
        </span>    </a>
</li>
                                </ul>
                    </div>
    </li>
            </ul>
    </div>

            
            <div id="title-heading" class="pagetitle with-breadcrumbs">
                
                                    <div id="breadcrumb-section">
                        
    
    
    <ol id="breadcrumbs">
                                        
                        
        <li class="first" >
                        
                            <span class=""><a href="https://cwiki.apache.org/confluence/collector/pages.action?key=Hive">Pages</a></span>
                                                                    
                        
        <li>
                        
                            <span class=""><a href="Home">Home</a></span>
                                                    </ol>


                    </div>
                
                
        <a href="Hive+on+Spark%253A+Getting+Started#page-banner-end" class="assistive">Skip to end of banner</a>
<div id="page-banner-start" class="assistive"></div>

                    
            <div id="page-metadata-banner"><ul class="banner"><li id="system-content-items" class="noprint"><a href="Hive+on+Spark%253A+Getting+Started" title="Restrictions apply" id="content-metadata-page-restrictions" class="hidden"><img class="page-banner-item-icon" src="../../s/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/_/download/resources/com.atlassian.confluence.plugins.confluence-page-banner%253Apage-banner-resources/images/red_padlock.png" style="height: 16px; width: 16px;"/></a><a href="https://cwiki.apache.org/confluence/pages/viewpageattachments.action?pageId=44302539&amp;metadataLink=true" title="1 attachment" id="content-metadata-attachments" ><img class="page-banner-item-icon" src="../../s/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/_/download/resources/com.atlassian.confluence.plugins.confluence-page-banner%253Apage-banner-resources/images/grey_attach.png" style="height: 16px; width: 16px;"/></a></li><li class="page-metadata-item noprint has-button"  id="content-metadata-jira-wrapper"><a href="Hive+on+Spark%253A+Getting+Started" title="" id="content-metadata-jira" class="aui-button aui-button-subtle content-metadata-jira tipsy-disabled hidden"><img class="page-banner-item-icon" src="../../s/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/_/download/resources/com.atlassian.confluence.plugins.confluence-jira-metadata%253Aconfluence-jira-metadata-resources/img/icon-jira-link.png" style="height: 16px; width: 16px;"/><span>JIRA links</span></a></li></ul></div>
            

<a href="Hive+on+Spark%253A+Getting+Started#page-banner-start" class="assistive">Go to start of banner</a>
<div id="page-banner-end" class="assistive"></div>
    

                <h1 id="title-text" class="with-breadcrumbs">
                                                <a href="Hive+on+Spark%253A+Getting+Started">Hive on Spark: Getting Started</a>
                                    </h1>
            </div>
        </div><!-- \#main-header -->
        
        

        <div id="sidebar-container">
                                                </div><!-- \#sidebar-container -->

        
    

        




        

    
    
        
    
    
                    
    

                        
    
    

    




<div id="content" class="page view">
    


<div id="action-messages">
                        </div>



        <script type="text/x-template" title="searchResultsGrid">
    <table class="aui">
        <thead>
            <tr class="header">
                <th class="search-result-title">Page Title</th>
                <th class="search-result-space">Space</th>
                <th class="search-result-date">Updated</th>
            </tr>
        </thead>
    </table>
</script>
<script type="text/x-template" title="searchResultsGridCount">
    <p class="search-result-count">{0}</p>
</script>
<script type="text/x-template" title="searchResultsGridRow">
    <tr class="search-result">
        <td class="search-result-title"><a href="https://cwiki.apache.org/confluence/display/Hive/{1}" class="content-type-{2}"><span>{0}</span></a></td>
        <td class="search-result-space"><a class="space" href="https://cwiki.apache.org/confluence/display/{4}/" title="{3}">{3}</a></td>
        <td class="search-result-date"><span class="date" title="{6}">{5}</span></td>
    </tr>
</script>
        
    
            

        
                            
    

                    

        
        <a href="Hive+on+Spark%253A+Getting+Started#page-metadata-end" class="assistive">Skip to end of metadata</a>
<div id="page-metadata-start" class="assistive"></div>

    <div class="page-metadata">
        <ul>
            <li class="page-metadata-modification-info">
                
        
    
        
    
        
        
            Created by <span class='author'>     <a href="https://cwiki.apache.org/confluence/display/~szehon"
                       class="url fn"
                            >Szehon Ho</a></span>, last modified by <span class='editor'>     <a href="https://cwiki.apache.org/confluence/display/~leftyl"
                       class="url fn"
                            >Lefty Leverenz</a></span> on <a class='last-modified' title='Oct 23, 2015 08:01' href='https://cwiki.apache.org/confluence/pages/diffpagesbyversion.action?pageId=44302539&amp;selectedPageVersions=88&amp;selectedPageVersions=89'>Oct 23, 2015</a>
                </li>
        </ul>
    </div>


<a href="Hive+on+Spark%253A+Getting+Started#page-metadata-start" class="assistive">Go to start of metadata</a>
<div id="page-metadata-end" class="assistive"></div>

        
                                            
        <div id="main-content" class="wiki-content">
                           
        <p><div class="toc-macro client-side-toc-macro " data-headerelements="H1,H2,H3,H4,H5,H6,H7"></div></p><p>Hive on Spark is now part of Hive since Hive 1.1 release. It is still under active development in &quot;spark&quot; branch, and is periodically merged into the &quot;master&quot; branch for Hive.  See <a href="https://issues.apache.org/jira/browse/HIVE-7292" style="font-size: 14.0px;line-height: 1.4285715;" class="external-link" rel="nofollow">HIVE-7292</a> and its subtasks and linked issues.</p><h2 id="HiveonSpark:GettingStarted-SparkInstallation">Spark Installation</h2><p><span style="font-size: 14.0px;line-height: 1.42857;">Follow instructions to install Spark: <span> </span><a href="http://spark.apache.org/docs/latest/running-on-yarn.html" class="external-link" rel="nofollow">http://spark.apache.org/docs/latest/running-on-yarn.html</a> (or </span><a href="https://spark.apache.org/docs/latest/spark-standalone.html" style="font-size: 14.0px;line-height: 1.42857;" class="external-link" rel="nofollow">https://spark.apache.org/docs/latest/spark-standalone.html</a>, if you are running Spark Standalone mode). Hive on Spark supports Spark on Yarn mode as default. In particular, for the installation you'll need to:</p><ol><li>Install Spark (either download pre-built Spark, or build assembly from source).  <ul><li>Install/build a compatible version.  Hive root <code>pom.xml</code>'s &lt;spark.version&gt; defines what version of Spark it was built/tested with. </li><li>Install/build a compatible distribution.  Each version of Spark has several distributions, corresponding with different versions of Hadoop.</li><li>Once Spark is installed, find and keep note of the &lt;spark-assembly-*.jar&gt; location.</li><li><p>Note that you must have a version of Spark which does <strong>not</strong> include the Hive jars. Meaning one which was not built with the Hive profile. If you will use Parquet tables, it's recommended to also enable the &quot;parquet-provided&quot; profile. Otherwise there could be conflicts in Parquet dependency. To remove Hive jars from the installation, simply use the following command under your Spark repository:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script type="syntaxhighlighter" class="brush: bash; gutter: false; theme: Default"><![CDATA[./make-distribution.sh --name &quot;hadoop2-without-hive&quot; --tgz &quot;-Pyarn,hadoop-provided,hadoop-2.4,parquet-provided&quot;]]></script>
</div></div></li></ul></li><li>Start Spark cluster (both standalone and Spark on YARN are supported).<ul><li>Keep note of the &lt;Spark Master URL&gt;.  This can be found in Spark master WebUI.</li></ul></li></ol><h2 id="HiveonSpark:GettingStarted-ConfiguringYarn">Configuring Yarn</h2><p>yarn.resourcemanager.scheduler.class=org.apache.hadoop.yarn.server.resourcemanager.scheduler.fair.FairScheduler</p><h2 id="HiveonSpark:GettingStarted-ConfiguringHive">Configuring Hive</h2><ol><li>There are several ways to add the Spark dependency to Hive:<br /><ol><li><p>Set the property 'spark.home' to point to the Spark installation:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script type="syntaxhighlighter" class="brush: java; gutter: false; theme: Default"><![CDATA[hive&gt; set spark.home=/location/to/sparkHome;]]></script>
</div></div></li><li><p>Define the SPARK_HOME environment variable before starting Hive CLI/HiveServer2:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script type="syntaxhighlighter" class="brush: bash; gutter: false; theme: Default"><![CDATA[export SPARK_HOME=/usr/lib/spark....]]></script>
</div></div></li><li>Link the spark-assembly jar to <code>HIVE_HOME/lib</code>.<br /><br /></li></ol></li><li><p>Configure Hive execution to Spark:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script type="syntaxhighlighter" class="brush: java; gutter: false; theme: Default"><![CDATA[hive&gt; set hive.execution.engine=spark;]]></script>
</div></div><p>See the <a href="Configuration+Properties#ConfigurationProperties-Spark">Spark section of Hive Configuration Properties</a> for other properties for configuring Hive and the Remote Spark Driver.</p><p> </p></li><li><p>Configure Spark-application configs for Hive.  See: <a href="http://spark.apache.org/docs/latest/configuration.html" class="external-link" rel="nofollow">http://spark.apache.org/docs/latest/configuration.html</a>.  This can be done either by adding a file &quot;spark-defaults.conf&quot; with these properties to the Hive classpath, or by setting them on Hive configuration (<code>hive-site.xml</code>). For instance:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script type="syntaxhighlighter" class="brush: java; gutter: false; theme: Default"><![CDATA[hive&gt; set spark.master=&lt;Spark Master URL&gt;

hive&gt; set spark.eventLog.enabled=true;

hive&gt; set spark.eventLog.dir=&lt;Spark event log folder (must exist)&gt;

hive&gt; set spark.executor.memory=512m;              

hive&gt; set spark.serializer=org.apache.spark.serializer.KryoSerializer;]]></script>
</div></div><p>A little explanation for some of the configuration properties:</p><ul><li><code>spark.executor.memory</code>: <span><span style="color: rgb(0,0,0);">Amount of memory to use per executor process. </span></span></li><li><span><span style="color: rgb(0,0,0);"><span><span style="color: rgb(0,0,0);"><code>spark.executor.cores</code>: Number of cores per executor.</span></span></span></span></li><li><p><span><code>spark.yarn.executor.memoryOverhead</code>: The amount of off heap memory (in megabytes) to be allocated per executor, when running Spark on Yarn. This is memory that accounts for things like VM overheads, interned strings, other native overheads, etc. In addition to the executor's memory, the container in which the executor is launched needs some extra memory for system processes, and this is what this overhead is for.</span></p></li><li><span><span style="color: rgb(0,0,0);"><span><span style="color: rgb(0,0,0);"><span><span style="color: rgb(0,0,0);"><code>spark.executor.instances</code>: The number of executors assigned to each application.</span></span></span></span></span></span></li><li><span style="color: rgb(0,0,0);"><span style="color: rgb(0,0,0);"><span style="color: rgb(51,51,51);line-height: 1.4285715;"><code>spark.driver.memory</code>: The amount of memory assigned to the Remote Spark Context (RSC). We recommend 4GB.</span></span></span></li><li><code style="line-height: 1.4285715;">spark.yarn.driver.memoryOverhead</code><span style="line-height: 1.4285715;">: We recommend 400 (MB).</span></li></ul></li></ol><h2 id="HiveonSpark:GettingStarted-ConfiguringSpark">Configuring Spark</h2><p><span style="color: rgb(0,0,0);line-height: 1.4285715;">Setting executor memory size is more complicated than simply setting it to be as large as possible. There are several things that need to be taken into consideration:</span></p><ul><li><p><span>More executor memory means it can enable mapjoin optimization for more queries.</span></p></li><li><p><span style="line-height: 1.4285715;">More executor memory, on the other hand, becomes unwieldy from GC perspective.</span></p></li><li><span><span style="color: rgb(0,0,0);"><span><span style="color: rgb(0,0,0);"><span><span style="color: rgb(0,0,0);"><span><span style="color: rgb(0,0,0);"><span><span style="color: rgb(0,0,0);">Some experiments shows that HDFS client doesn’t handle concurrent writers well, so it may face race condition if executor cores are too many. </span></span></span></span></span></span></span></span></span></span><span><span style="color: rgb(0,0,0);"><span><span style="color: rgb(0,0,0);"><span><span style="color: rgb(0,0,0);"><span><span style="color: rgb(0,0,0);"><span><span style="color: rgb(0,0,0);"><br /></span></span></span></span></span></span></span></span></span></span></li></ul><p><span><span><span style="color: rgb(0,0,0);"><span><span style="color: rgb(0,0,0);"><span><span style="color: rgb(0,0,0);"><span><span style="color: rgb(0,0,0);"><span><span style="color: rgb(0,0,0);">When running Spark on Yarn mode, </span></span></span></span></span></span></span></span></span></span></span><span style="color: rgb(0,0,0);">we generally recommend setting <span style="font-family: monospace;">spark.executor.cores</span><span style="color: rgb(0,0,0);"> </span></span><span style="color: rgb(0,0,0);">to be 5, 6 or 7, depending on what the typical node is divisible by. For instance, if <span style="font-family: monospace;">yarn.nodemanager.resource.cpu-vcores</span></span><span style="color: rgb(34,34,34);"> </span><span style="color: rgb(34,34,34);">is 19, then 6 is a better choice (all executors can only have the same number of cores, here if we chose 5, then every executor only gets 3 cores; if we chose 7, then only 2 executors are used, and 5 cores will be wasted). If it’s 20, then 5 is a better choice (since this way you’ll get 4 executors, and no core is wasted).</span></p><p><span style="color: rgb(34,34,34);">For</span><code><span style="color: rgb(34,34,34);"> spark.executor.memory</span></code><span style="color: rgb(34,34,34);">, we recommend to calculate <span style="font-family: monospace;">yarn.nodemanager.resource.memory-mb * (spark.executor.cores / yarn.nodemanager.resource.cpu-vcores)</span></span><span style="color: rgb(34,34,34);"> then split that between <span style="font-family: monospace;">spark.executor.memory</span></span><span style="color: rgb(34,34,34);"> </span><span style="color: rgb(34,34,34);">and <code>spark.yarn.executor.memoryOverhead</code></span><span style="color: rgb(34,34,34);">. According to our experiment, we recommend setting <code>spark.yarn.executor.memoryOverhead</code></span><span style="color: rgb(34,34,34);"> </span><span style="color: rgb(34,34,34);">to be around 15-20% of the total memory.</span></p><p><span style="color: rgb(0,0,0);">After you’ve decided on how much memory each executor receives, you need to decide how many executors will be allocated to queries. In the GA release Spark dynamic executor allocation will be supported. However for this beta only static resource allocation can be used. Based on the physical memory in each node and the configuration of  <code>spark.executor.memory</code> and <code>spark.yarn.executor.memoryOverhead</code></span><span style="color: rgb(0,0,0);">, you will need to choose the number of instances and set <code>spark.executor.instances</code>.</span></p><p><span style="color: rgb(0,0,0);">Now a real world example. Assuming 10 nodes with 64GB of memory per node with 12 virtual cores, e.g., <code>yarn.nodemanager.resource.cpu-vcores=12</code></span><span style="color: rgb(0,0,0);">. One node will be used as the master and as such the cluster will have 9 slave nodes. We’ll configure <code>spark.executor.cores</code> to 6. Given 64GB of ram <code>yarn.nodemanager.resource.memory-mb</code> will be 50GB. We’ll determine the amount of memory for each executor as follows: 50GB * (6/12) = 25GB. We’ll assign 20% to <code>spark.yarn.executor.memoryOverhead</code></span><span style="color: rgb(0,0,0);">, or 5120, and 80% to </span><code style="line-height: 1.4285715;"><span style="color: rgb(0,0,0);">spark.executor.memory</span></code><span style="color: rgb(0,0,0);">, or 20GB.</span></p><p><span style="color: rgb(0,0,0);">On this 9 node cluster we’ll have two executors per host. As such we can configure <code>spark.executor.instances</code></span><span style="color: rgb(0,0,0);"> somewhere between 2 and 18. A value of 18 would utilize the entire cluster.</span></p><h2 id="HiveonSpark:GettingStarted-CommonIssues(Greenareresolved,willberemovedfromthislist)">Common Issues (Green are resolved, will be removed from this list)</h2><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="confluenceTh">Issue</th><th class="confluenceTh">Cause</th><th class="confluenceTh">Resolution</th></tr><tr><td colspan="1" class="confluenceTd"><span style="color: rgb(34,34,34);">Error: Could not find or load main class org.apache.spark.deploy.</span><span style="color: rgb(34,34,34);">SparkSubmit</span></td><td colspan="1" class="confluenceTd">Spark dependency not correctly set.</td><td colspan="1" class="confluenceTd">Add Spark dependency to Hive, see Step 1 <a href="Hive+on+Spark%253A+Getting+Started#HiveonSpark:GettingStarted-ConfiguringHive">above</a>.</td></tr><tr><td colspan="1" class="confluenceTd"><p class="p1">org.apache.spark.SparkException: <span style="line-height: 1.42857;">Job aborted due to stage failure: </span></p><p class="p1"><span style="line-height: 1.42857;">Task 5.0:0 had a not serializable result: java.io.NotSerializableException: org.apache.hadoop.io.BytesWritable</span></p></td><td colspan="1" class="confluenceTd">Spark serializer not set to Kryo.</td><td colspan="1" class="confluenceTd">Set spark.serializer to be org.apache.spark.serializer.KryoSerializer, see Step 3 <a href="Hive+on+Spark%253A+Getting+Started#HiveonSpark:GettingStarted-ConfiguringHive">above</a>.</td></tr><tr><td colspan="1" class="confluenceTd"><p>[ERROR] Terminal initialization failed; falling back to unsupported<br />java.lang.IncompatibleClassChangeError: Found class jline.Terminal, but interface was expected</p></td><td colspan="1" class="confluenceTd">Hive has upgraded to Jline2 but jline 0.94 exists in the Hadoop lib.</td><td colspan="1" class="confluenceTd"><ol><li>Delete jline from the Hadoop lib directory (it's only pulled in transitively from ZooKeeper).</li><li><span>export HADOOP_USER_CLASSPATH_FIRST=true</span></li><li><span>If this error occurs during mvn test, perform a mvn clean install on the root project and itests directory.</span></li></ol></td></tr><tr><td colspan="1" class="confluenceTd"><p>Spark executor gets killed all the time and Spark keeps retrying the failed stage; you may find similar information in the YARN nodemanager log.</p><p>WARN org.apache.hadoop.yarn.server.nodemanager.containermanager.monitor.ContainersMonitorImpl: Container [pid=217989,containerID=container_1421717252700_0716_01_50767235] is running beyond physical memory limits. Current usage: 43.1 GB of 43 GB physical memory used; 43.9 GB of 90.3 GB virtual memory used. Killing container.</p></td><td colspan="1" class="confluenceTd">For Spark on YARN, nodemanager would kill Spark executor if it used more memory than the configured size of &quot;spark.executor.memory&quot; + &quot;spark.yarn.executor.memoryOverhead&quot;.</td><td colspan="1" class="confluenceTd">Increase &quot;spark.yarn.executor.memoryOverhead&quot; to make sure it covers the executor off-heap memory usage.</td></tr><tr><td colspan="1" class="confluenceTd"><p class="p1">Run query and get an error like:</p><p>FAILED: Execution Error, return code 3 from org.apache.hadoop.hive.ql.exec.spark.SparkTask</p><p>In Hive logs, it shows:</p><p class="p1">java.lang.NoClassDefFoundError: Could not initialize class org.xerial.snappy.Snappy<br /><span style="line-height: 1.4285715;"> </span><span class="Apple-tab-span" style="line-height: 1.4285715;"> </span><span style="line-height: 1.4285715;">at org.xerial.snappy.SnappyOutputStream.&lt;init&gt;(SnappyOutputStream.java:79)</span></p></td><td colspan="1" class="confluenceTd"><p>Happens on Mac (not officially supported).</p><p>This is a general Snappy issue with Mac and is not unique to Hive on Spark, but workaround is noted here because it is needed for startup of Spark client.</p></td><td colspan="1" class="confluenceTd"><p>Run this command before starting Hive or HiveServer2:</p><p>export HADOOP_OPTS=&quot;-Dorg.xerial.snappy.tempdir=/tmp -Dorg.xerial.snappy.lib.name=libsnappyjava.jnilib $HADOOP_OPTS&quot;</p></td></tr><tr><td colspan="1" class="confluenceTd"><p>Stack trace: ExitCodeException exitCode=1: .../launch_container.sh: line 27: $PWD:$PWD/__spark__.jar:$HADOOP_CONF_DIR.../usr/hdp/${hdp.version}/hadoop/lib/hadoop-lzo-0.6.0.${hdp.version}.jar:/etc/hadoop/conf/secure:$PWD/__app__.jar:$PWD/*: bad substitution</p><p> </p></td><td colspan="1" class="confluenceTd"><p>The key <span style="line-height: 1.4285715;">mapreduce.application.classpath in </span>/etc/hadoop/conf/mapred-site.xml contains a variable which is invalid in bash.</p></td><td colspan="1" class="confluenceTd"><p>From <span style="line-height: 1.4285715;"><strong>mapreduce.application.classpath</strong> r</span><span style="line-height: 1.4285715;">emove</span></p><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<script type="syntaxhighlighter" class="brush: java; gutter: false; theme: Default"><![CDATA[:/usr/hdp/${hdp.version}/hadoop/lib/hadoop-lzo-0.6.0.${hdp.version}.jar]]></script>
</div></div><p>from</p><p class="p1"><strong>/etc/hadoop/conf/mapred-site.xml</strong></p></td></tr><tr><td colspan="1" class="confluenceTd"><p>Exception in thread &quot;Driver&quot; scala.MatchError: java.lang.NoClassDefFoundError: org/apache/hadoop/mapreduce/TaskAttemptContext (of class java.lang.NoClassDefFoundError)<br /><span> </span><span class="Apple-tab-span"> </span><span>at</span><span style="line-height: 1.4285715;"> org.apache.spark.deploy.yarn.ApplicationMaster$$anon$2.run(ApplicationMaster.scala:432)</span></p></td><td colspan="1" class="confluenceTd">MR is not on the YARN classpath.</td><td colspan="1" class="confluenceTd"><p>If on HDP change from</p><p><strong>/hdp/apps/${hdp.version}/mapreduce/mapreduce.tar.gz#mr-framework</strong></p><p>to</p><p><strong>/hdp/apps/2.2.0.0-2041/mapreduce/mapreduce.tar.gz#mr-framework</strong></p></td></tr></tbody></table></div><h2 id="HiveonSpark:GettingStarted-RecommendedConfiguration">Recommended Configuration</h2><div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre># see HIVE-9153
mapreduce.input.fileinputformat.split.maxsize=750000000
hive.vectorized.execution.enabled=true

hive.cbo.enable=true
hive.optimize.reducededuplication.min.reducer=4
hive.optimize.reducededuplication=true
hive.orc.splits.include.file.footer=false
hive.merge.mapfiles=true
hive.merge.sparkfiles=false
hive.merge.smallfiles.avgsize=16000000
hive.merge.size.per.task=256000000
hive.merge.orcfile.stripe.level=true
hive.auto.convert.join=true
hive.auto.convert.join.noconditionaltask=true
hive.auto.convert.join.noconditionaltask.size=894435328
hive.optimize.bucketmapjoin.sortedmerge=false
hive.map.aggr.hash.percentmemory=0.5
hive.map.aggr=true
hive.optimize.sort.dynamic.partition=false
hive.stats.autogather=true
hive.stats.fetch.column.stats=true
hive.vectorized.execution.reduce.enabled=false
hive.vectorized.groupby.checkinterval=4096
hive.vectorized.groupby.flush.percent=0.1
hive.compute.query.using.stats=true
hive.limit.pushdown.memory.usage=0.4
hive.optimize.index.filter=true
hive.exec.reducers.bytes.per.reducer=67108864
hive.smbjoin.cache.rows=10000
hive.exec.orc.default.stripe.size=67108864
hive.fetch.task.conversion=more
hive.fetch.task.conversion.threshold=1073741824
hive.fetch.task.aggr=false
mapreduce.input.fileinputformat.list-status.num-threads=5
spark.kryo.referenceTracking=false
spark.kryo.classesToRegister=org.apache.hadoop.hive.ql.io.HiveKey,org.apache.hadoop.io.BytesWritable,org.apache.hadoop.hive.ql.exec.vector.VectorizedRowBatch</pre>
</div></div><h2 id="HiveonSpark:GettingStarted-Designdocuments">Design documents</h2><div><ul><li><a href="https://issues.apache.org/jira/secure/attachment/12652517/Hive-on-Spark.pdf" class="external-link" rel="nofollow">Hive on Spark: Overall Design</a> from <a href="https://issues.apache.org/jira/browse/HIVE-7292" class="external-link" rel="nofollow">HIVE-7272</a></li><li><a href="Hive+on+Spark%253A+Join+Design+Master" style="line-height: 1.4285715;" rel="nofollow">Hive on Spark: Join Design (HIVE-7613)</a></li><li><a href="https://issues.apache.org/jira/browse/HIVE-9449" class="external-link" rel="nofollow">Hive on Spark Configuration (HIVE-9449)</a></li><li><a href="https://cwiki.apache.org/confluence/download/attachments/44302539/hos_explain.pdf?version=1&amp;modificationDate=1425575903000&amp;api=v2" data-linked-resource-id="53575687" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="hos_explain.pdf" data-nice-type="PDF Document" data-linked-resource-content-type="application/pdf" data-linked-resource-container-id="44302539" data-linked-resource-container-version="89">Hive on Spark Explain Plan</a></li></ul></div>

                
        
    
        </div>

        <!--
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
         xmlns:dc="http://purl.org/dc/elements/1.1/"
         xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
         <rdf:Description
    rdf:about="https://cwiki.apache.org/confluence/display/Hive/Hive+on+Spark%3A+Getting+Started"
    dc:identifier="https://cwiki.apache.org/confluence/display/Hive/Hive+on+Spark%3A+Getting+Started"
    dc:title="Hive on Spark: Getting Started"
    trackback:ping="https://cwiki.apache.org/confluence/rpc/trackback/44302539"/>
</rdf:RDF>
-->

                        
    



<div id="labels-section" class="pageSection group">
    <div class="labels-section-content content-column" entityid="44302539" entitytype="page">
	<div class="labels-content">
		
    <ul class="label-list label-list-right ">
            <li class="no-labels-message">
            No labels
        </li>
            </ul>

    </div>
</div>
</div>
        
		
            




            
    








                        
    
<div id="comments-section" class="pageSection group">
                <div class="section-header">
            <h2 id="comments-section-title" class="section-title">
                                    1 Comment
                            </h2>
        </div>
    
    

            <ol class="comment-threads top-level" id="page-comments">
                    <li id="comment-thread-50859167" class="comment-thread">
        <div class="comment  " id="comment-50859167">
        <p class="comment-user-logo">
            <img class="userLogo logo anonymous" src="../../s/en_GB/5982/f2b47fb3d636c8bc9fd0b11c0ec6d0ae18646be7.1/_/images/icons/profilepics/anonymous.png"
           alt="User icon: lirui" title="lirui">        </p>
        <div class="comment-header">
            <h4 class="author">    <a href="https://cwiki.apache.org/confluence/display/~lirui"
                       class="url fn"
                            >Rui Li</a></h4>
        </div>
        <div class="comment-body">
            <div class="comment-content wiki-content">
                <p>Spark has its own property to control whether to merge small files. Set hive.merge.sparkfiles=true to merge small files.</p>
            </div>
            <div class="comment-actions">
                                                <ul class="comment-actions-secondary">
                                                              <li class="first comment-permalink"><a title="Permanent link to this comment" href="Hive+on+Spark%253A+Getting+Started@focusedCommentId=50859167#comment-50859167"
                 id="comment-permalink-50859167"                     ><span>Permalink</span></a></li>
            </ul>
                                    <ul class="comment-actions-primary">
                                                              <li class="first comment-date"><a title="Jan 15, 2015 01:34" href="Hive+on+Spark%253A+Getting+Started@focusedCommentId=50859167#comment-50859167"
                                    ><span>Jan 15, 2015</span></a></li>
                                                              <li class=" "><a  href="https://cwiki.apache.org/confluence/plugins/aptis/deleteAllComments/ask-user.action?pageId=44302539"
                 id="delete-all-comments-link-comment-link-50859167"                     ><span>Delete comments</span></a></li>
            </ul>
                </div>
        </div>
    </div>

    <!--
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
         xmlns:dc="http://purl.org/dc/elements/1.1/"
         xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
         <rdf:Description
    rdf:about="https://cwiki.apache.org/confluence/display/Hive/Hive+on+Spark%3A+Getting+Started?focusedCommentId=50859167#comment-50859167"
    dc:identifier="https://cwiki.apache.org/confluence/display/Hive/Hive+on+Spark%3A+Getting+Started?focusedCommentId=50859167#comment-50859167"
    dc:title="Hive on Spark: Getting Started"
    trackback:ping="https://cwiki.apache.org/confluence/rpc/trackback/50859167"/>
</rdf:RDF>
-->

    
    </li>
            </ol>


</div>


                
    
            
</div>


    




    
    

    
    
    


    
<div id="space-tools-web-items" class="hidden">
                <div data-label="Overview" data-href="/confluence/spaces/viewspacesummary.action?key=Hive">Overview</div>
            <div data-label="Content Tools" data-href="/confluence/pages/reorderpages.action?key=Hive">Content Tools</div>
            <div data-label="Add-ons" data-href="/confluence/spaces/snippeterrors.action?key=Hive">Add-ons</div>
    </div>




    </div><!-- \#main -->
        
    
        
            
            

<div id="footer" role="contentinfo">
    <section class="footer-body">

                                                            <p class="license license-opensource">
                    Powered by a free <b>Atlassian Confluence Open Source Project License</b> granted to Apache Software Foundation. <a href="http://www.atlassian.com/c/conf/11461">Evaluate Confluence today</a>.<br>
                </p>
                    
        

        <ul id="poweredby">
            <li class="noprint">Powered by <a href="http://www.atlassian.com/software/confluence" class="hover-footer-link">Atlassian Confluence</a> <span id='footer-build-information'>5.8.4</span>, <a href="http://www.atlassian.com/software/confluence/overview/team-collaboration-software?utm_source=confluence-footer" class="hover-footer-link">Team Collaboration Software</a></li>
            <li class="print-only">Printed by Atlassian Confluence 5.8.4, Team Collaboration Software.</li>
            <li class="noprint"><a href="https://jira.atlassian.com/browse/CONF" class="hover-footer-link">Report a bug</a></li>
            <li class="noprint"><a href="http://www.atlassian.com/about/connected.jsp?s_kwcid=Confluence-stayintouch" class="hover-footer-link">Atlassian News</a></li>
        </ul>

        

        <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>

                    
        
    </section>
</div>

    
</div>

</div><!-- \#full-height-container -->
</div><!-- \#page -->
</body>
</html>
